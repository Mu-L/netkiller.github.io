<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>第 30 章 Spring boot with Monitor</title><link rel="stylesheet" type="text/css" href="../../docbook.css"/><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"/><meta name="keywords" content="Spring, Spring Boot, Spring Cloud, Spring Eureka, Spring Config"/><link rel="prev" href="../ch29s02.xhtml" title="引用 starter"/><link rel="next" href="ch31.xhtml" title="第 31 章 SpringBoot Admin"/></head><body><header><div class="navheader"><table style="width: 100%; "><tr><th style="text-align: center; " colspan="3">第 30 章 Spring boot with Monitor</th></tr><tr><td style="width: 20%; text-align: left; "><a accesskey="p" href="../ch29s02.xhtml">上一页</a> </td><th style="width: 60%; text-align: center; ">部分 I. Spring Boot</th><td style="width: 20%; text-align: right; "> <a accesskey="n" href="ch31.xhtml">下一页</a></td></tr></table><hr/></div></header><section class="chapter" id="index"><div class="titlepage"><div><div><h2 class="title">第 30 章 Spring boot with Monitor</h2></div></div></div><div class="toc"><div class="toc-title">目录</div><ul class="toc"><li><span class="section"><a href="ch30.xhtml#springboot.grafana">Spring boot with Grafana</a></span><ul><li><span class="section"><a href="ch30.xhtml#id897">Springboot 集成 InfluxDB</a></span></li><li><span class="section"><a href="ch30.xhtml#id898">InfluxDB</a></span></li></ul></li><li><span class="section"><a href="ch30s02.xhtml">Spring Boot with Prometheus</a></span><ul><li><span class="section"><a href="ch30s02.xhtml#id899">Maven 依赖</a></span></li><li><span class="section"><a href="ch30s02.xhtml#id900">application.properties 配置文件</a></span></li><li><span class="section"><a href="ch30s02.xhtml#id901">启动类</a></span></li><li><span class="section"><a href="ch30s02.xhtml#id902">测试</a></span></li><li><span class="section"><a href="ch30s02.xhtml#id903">控制器监控</a></span></li><li><span class="section"><a href="ch30s02.xhtml#id908">自定义埋点监控</a></span></li></ul></li></ul></div><section class="section" id="springboot.grafana"><div class="titlepage"><div><div><h3 class="title">Spring boot with Grafana</h3></div></div></div><section class="section" id="id897"><div class="titlepage"><div><div><h4 class="title">Springboot 集成 InfluxDB</h4></div></div></div><p>Springboot 集成 InfluxDB 非常简单，先引入依赖即可，记得需要同时引入 actuator</p><pre class="screen">
		
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
  &lt;artifactId&gt;micrometer-registry-influx&lt;/artifactId&gt;
&lt;/dependency&gt;		
		
			</pre><p>配置文件 application.yaml 如下</p><pre class="screen">
		
spring:
  application:
    name: springboot-with-influxdb
server:
  port: 8080
management:
  metrics:
    export:
      influx:
        enabled: true
        db: springboot
        uri: http://localhost:8086
        user-name:
        password:
        connect-timeout: 1s
        read-timeout: 10s
        auto-create-db: true
        step: 1m
        num-threads: 2
        consistency: one
        compressed: true
        batch-size: 1000		
		
			</pre></section><section class="section" id="id898"><div class="titlepage"><div><div><h4 class="title">InfluxDB</h4></div></div></div><p>配置好 Springboot 后，启动应用，稍后Springboot 就会将数据源源不断地写入到 InfluxDB 中。</p><pre class="screen">
		
&gt; show measurements
name: measurements
name
----
jvm_buffer_count
jvm_buffer_memory_used
jvm_buffer_total_capacity
jvm_classes_loaded
jvm_classes_unloaded
jvm_gc_live_data_size
jvm_gc_max_data_size
jvm_gc_memory_allocated
jvm_gc_memory_promoted
jvm_gc_pause
jvm_memory_committed
jvm_memory_max
jvm_memory_used
jvm_threads_daemon
jvm_threads_live
jvm_threads_peak
jvm_threads_states
logback_events
process_cpu_usage
process_files_max
process_files_open
process_start_time
process_uptime
system_cpu_count
system_cpu_usage
system_load_average_1m
tomcat_sessions_active_current
tomcat_sessions_active_max
tomcat_sessions_alive_max
tomcat_sessions_created
tomcat_sessions_expired
tomcat_sessions_rejected
visits		
		
			</pre><p>查看数据</p><pre class="screen">
		
select * from process_cpu_usage
		
			</pre></section></section></section><footer><div class="navfooter"><hr/><table style="width: 100%; "><tr><td style="width: 40%; text-align: left; "><a accesskey="p" href="../ch29s02.xhtml">上一页</a> </td><td style="width: 20%; text-align: center; "><a accesskey="u" href="../pt01.xhtml">上一级</a></td><td style="width: 40%; text-align: right; "> <a accesskey="n" href="ch31.xhtml">下一页</a></td></tr><tr><td style="width: 40%; text-align: left; vertical-align: top; ">引用 starter </td><td style="width: 20%; text-align: center; "><a accesskey="h" href="../../index.xhtml">起始页</a></td><td style="width: 40%; text-align: right; vertical-align: top; "> 第 31 章 SpringBoot Admin</td></tr></table></div></footer></body></html>