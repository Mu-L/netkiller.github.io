<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 26 章 自动化运维</title><link rel="stylesheet" type="text/css" href="../docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><meta name="keywords" content="php,pear,pecl,phar, python, , " /><link rel="home" href="../index.html" title="Netkiller Python 手札" /><link rel="up" href="../index.html" title="Netkiller Python 手札" /><link rel="prev" href="../chart/ch25s02.html" title="25.2. pyecharts" /><link rel="next" href="防火墙.html" title="26.2. Python 开发防火墙" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> | <a xmlns="" href="//netkiller.github.io/">简体中文</a> | <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> | <a xmlns="" href="/journal/index.html">杂文</a>
		| <a xmlns="" href="https://github.com/netkiller">Github</a> | <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> | <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> | <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> | <a xmlns="" href="https://www.youtube.com/user/bg7nyt/videos">Youtube</a> | <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> | <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 26 章 自动化运维</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../chart/ch25s02.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="防火墙.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a></td><td></td><td></td><td></td><td></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>第 26 章 自动化运维</h1></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#日志中心">26.1. 日志中心</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#id1396">26.1.1. 什么是日志中心</a></span></dt><dt><span class="section"><a href="index.html#id1397">26.1.2. 工作原理</a></span></dt><dt><span class="section"><a href="index.html#id1398">26.1.3. 安装</a></span></dt><dt><span class="section"><a href="index.html#id1401">26.1.4. 命令</a></span></dt><dt><span class="section"><a href="index.html#id1406">26.1.5. 操作演示</a></span></dt></dl></dd><dt><span class="section"><a href="防火墙.html">26.2. Python 开发防火墙</a></span></dt><dd><dl><dt><span class="section"><a href="防火墙.html#id1407">26.2.1. 我为什么要开发一个防火墙软件？</a></span></dt><dt><span class="section"><a href="防火墙.html#id1408">26.2.2. 安装 Python 防火墙</a></span></dt><dt><span class="section"><a href="防火墙.html#id1409">26.2.3. 切换防火墙规则</a></span></dt><dt><span class="section"><a href="防火墙.html#id1410">26.2.4. 规则库</a></span></dt></dl></dd><dt><span class="section"><a href="ch26s03.html">26.3. 监视文件系统</a></span></dt><dd><dl><dt><span class="section"><a href="ch26s03.html#id1415">26.3.1. watchdog</a></span></dt><dt><span class="section"><a href="ch26s03.html#id1416">26.3.2. pyinotify</a></span></dt></dl></dd><dt><span class="section"><a href="container.html">26.4. 容器</a></span></dt><dd><dl><dt><span class="section"><a href="container.html#id1417">26.4.1. 在 Docker 容器中运行 Python 项目</a></span></dt><dt><span class="section"><a href="container.html#id1418">26.4.2. 在 kubernetes 中部署项目</a></span></dt></dl></dd></dl></div>
	
	
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="日志中心"></a>26.1. 日志中心</h2></div></div></div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id1396"></a>26.1.1. 什么是日志中心</h3></div></div></div>
		
		<p>日志中心是针对日志类数据一站式管理，日志中心分成两部分，分别是采集端和收集端。</p>
		<p>采集器从各服务器采集数据，然后发送给接收端，接收端接到数据后，将日志保存到磁盘上。用户能在日志中心服务器上查询和分析日志，帮助运维、运营提升效率。</p>
		<p>当年我开发此程序的时候还没有出现如今流行的ELK方案，接下来就让我为大家介绍如何使用 Python 开发一个日志采集和接受程序。</p>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id1397"></a>26.1.2. 工作原理</h3></div></div></div>
		
		<p>日志采集端：有两种工作方式：一种是文件采集，另一种是标准输出采集。文件采集又分为，静态日志文件采集，将整个文件给接收端。动态文件采集，仅采集添加到日志文件尾部的更新内容，即每次只读取日志追加的内容。</p>
		<p>日志接收端： 启动后进入后台，开启UDP端口，等候采集端发送内容。</p>
	</div>

	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id1398"></a>26.1.3. 安装</h3></div></div></div>
		
		<p>pip 安装</p>
		<pre class="screen">
		
[root@localhost ~]# pip3 install netkiller-logging
		
		</pre>
		<p>源码安装</p>
		<pre class="screen">
		
[root@localhost ~]# git clone https://github.com/netkiller/logging.git
[root@localhost ~]# cd logging
[root@localhost ~]# python3 setup.py sdist
[root@localhost ~]# python3 setup.py install		
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id1401"></a>26.1.4. 命令</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1399"></a>26.1.4.1. 日志采集端</h4></div></div></div>
			
			<p>日志采集端名师是 rlog</p>
			<pre class="screen">
		
[root@localhost ~]# whereis rlog 
rlog: /usr/local/bin/rlog

[root@localhost ~]# rlog 
Usage: rlog [options] filename

Options:
-h, --help            show this help message and exit
-H localhost, --host=localhost
						push log to remote host
-p 1214, --port=1214  port
--sleep=0.05          with -s, sleep  for  approximately S  seconds between
						iterations
-d, --daemon          run as daemon
-f, --full            Full text
--stdin               cat file | prog ...
-e /tmp/rlog.log, --errlog=/tmp/rlog.log
						error log
--postion             save postion of log file

Homepage: http://netkiller.github.io	Author: Neo &lt;netkiller@msn.com&gt;				
		
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1400"></a>26.1.4.2. 日志接收端</h4></div></div></div>
			
			<p>日志接收端命令式 collection</p>
			<pre class="screen">
		
[root@localhost ~]# collection 
Usage: collection [options] module

Options:
  -h, --help            show this help message and exit
  -p 1214, --port=1214  port
  -l /tmp/test.log, --logfile=/tmp/test.log
						log file
  --list                show module message
  -d, --daemon          run as daemon

  Homepage: http://netkiller.github.io	Author: Neo &lt;netkiller@msn.com&gt;		
		
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id1406"></a>26.1.5. 操作演示</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1402"></a>26.1.5.1. 从标准输出采集日志</h4></div></div></div>
			
			<p>日志接收端命令：</p>
			<pre class="screen">
			
collection -p 1214			
			
			</pre>
			<p>启动日志接收程序，使用UDP 1214 端口接收日志。</p>
			<p>日志采集端命令：</p>
			<pre class="screen">
			
echo Helloworld | rlog -H 127.0.0.1 —stdin			
			
			</pre>
			<p>运行日志采集程序，将标准输出内容发送到日志接收端。</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1403"></a>26.1.5.2. 发送日志文件</h4></div></div></div>
			
			<p>将日志文件发送给日志接收端</p>
			<p>日志接收端命令：</p>
			<pre class="screen">
			
collection -p 1214
			
			</pre>
			<p>这里仅仅演示，所以我们在终端输出日志。</p>
			<p>日志采集端命令：</p>
			<pre class="screen">
			
rlog -H 127.0.0.1 -f /var/log/your.log
			
			</pre>
			<p>参数 -f 是指发送整个文件，否则只会发送采集程序启动后，追加的日志。</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1404"></a>26.1.5.3. 接收日志并保存到文件</h4></div></div></div>
			
			<p>日志接收端命令：</p>
			<pre class="screen">
			
collection -p 1214 -l /tmp/test.log		
			
			</pre>
			<p>参数 -l 表示将接收到的日志写入文件，使用 -l 参数后，终端屏幕不再输出内容</p>
			<p>日志采集端命令：</p>
			<pre class="screen">
			
rlog -H 127.0.0.1 -f /var/log/your.log
			
			</pre>
			<p>参数 -f 是指发送整个文件，否则只会发送采集程序启动后，追加的日志。</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1405"></a>26.1.5.4. 发送动态日志文件</h4></div></div></div>
			
			<p>所谓动态日志文件是指，正在运行的程序随时向日志追加内容，例如WEB服务器nginx</p>
			<p>日志接收端命令：</p>
			<pre class="screen">
			
collection -d -p 1214 -l /tmp/test.log
			
			</pre>
			<p>参数 -d 表示后台运行，-l 将接收到的日志写入文件</p>
			<p>日志采集端命令：</p>
			<pre class="screen">
			
rlog -d -H 127.0.0.1 /var/log/your.log
			
			</pre>
			<p>参数 -d 表示rlog启动后在后台运行，注意不要使用 -f 参数</p>
		</div>
	</div>
</div>
	

	

	



</div><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../chart/ch25s02.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="防火墙.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">25.2. pyecharts </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 26.2. Python 开发防火墙</td></tr></table></div><script xmlns="">
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-11694057-1', 'auto');
			ga('send', 'pageview');

		</script><script xmlns="" async="async">
			var _hmt = _hmt || [];
			(function() {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
			})();
</script><script xmlns="" async="async">
			(function(){
			var bp = document.createElement('script');
			var curProtocol = window.location.protocol.split(':')[0];
			if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
			}
			else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
			}
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(bp, s);
			})();
</script></body></html>