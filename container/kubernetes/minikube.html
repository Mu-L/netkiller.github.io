<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 3 章 Minikube</title><link rel="stylesheet" type="text/css" href="../docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><meta name="keywords" content="qmeu,kvm,xen,openvz, docker, coreos,docker-compose, kubernetes,kubeadmin,kubectl, netkiller-devops" /><link rel="home" href="../index.html" title="Netkiller Container 手札" /><link rel="up" href="index.html" title="部分 I. Kubernetes" /><link rel="prev" href="index.html" title="部分 I. Kubernetes" /><link rel="next" href="minikube.Quickstart.html" title="3.2. Quickstart" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="https://github.com/netkiller">Github</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
   	    <a xmlns="" href="https://edu.51cto.com/lecturer/1703915.html">51CTO学院</a> |
	    <a xmlns="" href="https://edu.csdn.net/lecturer/6423">CSDN程序员研修院</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://cloud.tencent.com/developer/column/2078">腾讯云社区</a> |
	    <a xmlns="" href="https://yq.aliyun.com/u/netkiller/">阿里云栖社区</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="https://www.youtube.com/user/bg7nyt/videos">Youtube</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 3 章 Minikube</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">上一页</a> </td><th width="60%" align="center">部分 I. Kubernetes</th><td width="20%" align="right"> <a accesskey="n" href="minikube.Quickstart.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> ｜ <a href="https://www.zhihu.com/club/1241768772601950208">多维度架构</a></td><td></td><td></td><td></td><td></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="minikube"></a>第 3 章 Minikube</h2></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="minikube.html#minikube.install">3.1. CentOS 8 安装 minikube</a></span></dt><dd><dl><dt><span class="section"><a href="minikube.html#idm40104568368">3.1.1. CentOS</a></span></dt><dt><span class="section"><a href="minikube.html#idm40104568112">3.1.2. Mac OS</a></span></dt></dl></dd><dt><span class="section"><a href="minikube.Quickstart.html">3.2. Quickstart</a></span></dt><dt><span class="section"><a href="minikube.command.html">3.3. minikube 命令</a></span></dt><dd><dl><dt><span class="section"><a href="minikube.command.html#minikube.ip">3.3.1. minikube ip 地址</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.start">3.3.2. 启动 minikube</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.stop">3.3.3. 停止 minikube</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.docker-env">3.3.4. Docker 环境变量</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.ssh">3.3.5. SSH</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.cache">3.3.6. 缓存镜像</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.delete">3.3.7. 清理 minikube</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.dashboard">3.3.8. Kubernetes 控制面板</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.service">3.3.9. service</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.logs">3.3.10. 查看日志</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.docker-env">3.3.11. 查看 Docker 环境变量</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.profile">3.3.12. profile</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.addons">3.3.13. addons</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.ssh">3.3.14. SSH</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.ip">3.3.15. 查看IP地址</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.image">3.3.16. 镜像管理</a></span></dt><dt><span class="section"><a href="minikube.command.html#minikube.kubectl">3.3.17. kubectl</a></span></dt></dl></dd><dt><span class="section"><a href="ch03s04.html">3.4. Minikube 案例演示</a></span></dt><dt><span class="section"><a href="minikube.faq.html">3.5. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="minikube.faq.html#idm40101898592">3.5.1. This computer doesn't have VT-X/AMD-v enabled. Enabling it in the BIOS is mandatory</a></span></dt><dt><span class="section"><a href="minikube.faq.html#idm40101896464">3.5.2. ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables</a></span></dt><dt><span class="section"><a href="minikube.faq.html#idm40101894464">3.5.3. ERROR ImagePull</a></span></dt><dt><span class="section"><a href="minikube.faq.html#idm40101892160">3.5.4. 证书已存在错误</a></span></dt><dt><span class="section"><a href="minikube.faq.html#idm40101887920">3.5.5. http: server gave HTTP response to HTTPS client</a></span></dt><dt><span class="section"><a href="minikube.faq.html#idm40101883920">3.5.6. provided port is not in the valid range. The range of valid ports is 30000-32767</a></span></dt><dt><span class="section"><a href="minikube.faq.html#idm40101883664">3.5.7. Exiting due to MK_ENABLE: run callbacks: running callbacks: [verifying registry addon pods : timed out waiting for the condition: timed out waiting for the condition]</a></span></dt><dt><span class="section"><a href="minikube.faq.html#idm40101877504">3.5.8.  Exiting due to SVC_URL_TIMEOUT: http://127.0.0.1:11068/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ is not accessible: Temporary Error: unexpected response code: 503</a></span></dt><dt><span class="section"><a href="minikube.faq.html#idm40101874112">3.5.9. Mac minikube ip 不通，ingress 不工作</a></span></dt></dl></dd></dl></div>
	
	<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="minikube.install"></a>3.1. CentOS 8 安装 minikube</h2></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm40104568368"></a>3.1.1. CentOS</h3></div></div></div>
			
			<p>执行下面命令检查服务器是否开启虚拟化技术</p>
			<pre class="screen">
			
egrep --color 'vmx|svm' /proc/cpuinfo
			
			</pre>
			<p>如果没有任何输出，请重启服务器进入 BIOS 启用 VT-X 或 AMD-v</p>
			<pre class="screen">
			
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
  &amp;&amp; install minikube-linux-amd64 /usr/local/bin/minikube		 	
			
			</pre>
			<p>尝试运行 minikube 如果输出帮助信息表示安装成功</p>
			<pre class="screen">
			
[root@localhost ~]# minikube version
minikube version: v1.13.0
commit: 0c5e9de4ca6f9c55147ae7f90af97eff5befef5f-dirty			
			
			</pre>
			<p></p>
			<pre class="screen">
			
echo "1" &gt; /proc/sys/net/bridge/bridge-nf-call-iptables			
			
			</pre>
			<p>dnf 安装 kubectl</p>
			<pre class="screen">
			
cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF
			
			</pre>
			<pre class="screen">
			
[root@localhost ~]# dnf install kubectl
			
			</pre>
			<p>二进制安装 kubectl</p>
			<pre class="screen">
						
curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl" \
	&amp;&amp; install kubectl /usr/local/bin/kubectl
			
			</pre>
			<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm40104560944"></a>3.1.1.1. 无虚拟机</h4></div></div></div>
				
				<p>如果你不想安装虚拟机</p>
				<pre class="screen">
			
adduser docker
su - docker
sudo usermod -aG docker $USER &amp;&amp; newgrp docker			
			
				</pre>
				<p></p>
				<pre class="screen">
				
[docker@localhost ~]$ minikube start --driver=docker
* minikube v1.13.0 on Centos 8.2.2004
* Using the docker driver based on user configuration

X Requested memory allocation (1694MB) is less than the recommended minimum 2000MB. Deployments may fail.


X The requested memory allocation of 1694MiB does not leave room for system overhead (total system memory: 1694MiB). You may face stability issues.
* Suggestion: Start minikube with less memory allocated: 'minikube start --memory=1694mb'

* Starting control plane node minikube in cluster minikube
* Pulling base image ...
* Downloading Kubernetes v1.19.0 preload ...
    &gt; preloaded-images-k8s-v6-v1.19.0-docker-overlay2-amd64.tar.lz4: 486.28 MiB				
				
				</pre>
			</div>

		</div>

		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm40104568112"></a>3.1.2. Mac OS</h3></div></div></div>
			
			<p>检查硬件是否支持虚拟化</p>
			<pre class="screen">
			
iMac:Linux neo$ sysctl -a | grep -E --color 'machdep.cpu.features|VMX'
machdep.cpu.features: FPU VME DE PSE TSC MSR PAE MCE CX8 APIC SEP MTRR PGE MCA CMOV PAT PSE36 CLFSH DS ACPI MMX FXSR SSE SSE2 SS HTT TM PBE SSE3 PCLMULQDQ DTES64 MON DSCPL VMX SMX EST TM2 SSSE3 CX16 TPR PDCM SSE4.1 SSE4.2 x2APIC POPCNT AES PCID XSAVE OSXSAVE TSCTMR AVX1.0			
			
			</pre>
			<pre class="screen">
			
$ brew install hyperkit			
$ brew install minikube
$ brew install kubectl
$ brew install kubernetes-helm
			
			</pre>
			<pre class="screen">
			
neo@MacBook-Pro-Neo ~ % minikube start                 
😄  minikube v1.13.1 on Darwin 11.0
🆕  Kubernetes 1.19.2 is now available. If you would like to upgrade, specify: --kubernetes-version=v1.19.2
✨  Using the hyperkit driver based on existing profile
👍  Starting control plane node minikube in cluster minikube
🔄  Restarting existing hyperkit VM for "minikube" ...
❗  This VM is having trouble accessing https://k8s.gcr.io
💡  To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/
🐳  Preparing Kubernetes v1.19.0 on Docker 19.03.12 ...
🔎  Verifying Kubernetes components...
🌟  Enabled addons: dashboard, default-storageclass, storage-provisioner
🏄  Done! kubectl is now configured to use "minikube" by default			
			
			</pre>
			<p>有些老系统可能不支持 hyperkit，需要virtualbox。</p>
			<pre class="screen">
			
$ brew cask install virtualbox
$ minikube start —vm-driver=virtualbox
$ minikube dashboard			
			
			</pre>
			<p>检查 minikube 启动状态</p>
			<pre class="programlisting">
			
Neo-iMac:~ neo$ docker container inspect minikube --format={{.State.Status}}
running			
			
			</pre>
		</div>
	</div>
	

	
	
	
</div><div xmlns="" id="SOHUCS"></div><script xmlns="" charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/changyan.js"></script><script xmlns="" type="text/javascript">
window.changyan.api.config({
appid: 'cyvwjQUG3',
conf: 'prod_ef966242df3d8b5acb1e0ee9fc01cafe'
});
</script><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="index.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="minikube.Quickstart.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">部分 I. Kubernetes </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 3.2. Quickstart</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script></body></html>