<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 3 章 Podman</title><link rel="stylesheet" type="text/css" href="../docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><meta name="keywords" content="qmeu,kvm,xen,openvz, docker, coreos,docker-compose, kubernetes,kubeadmin,kubectl, netkiller-devops" /><link rel="home" href="../index.html" title="Netkiller Container 手札" /><link rel="up" href="../index.html" title="Netkiller Container 手札" /><link rel="prev" href="../docker/docker.faq.html" title="2.15. Docker FAQ" /><link rel="next" href="podman.manual.html" title="3.2. podman 管理" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> | <a xmlns="" href="//netkiller.github.io/">简体中文</a> | <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> | <a xmlns="" href="/journal/index.html">杂文</a>
		| <a xmlns="" href="https://github.com/netkiller">Github</a> | <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> | <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> | <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> | <a xmlns="" href="https://www.youtube.com/user/bg7nyt/videos">Youtube</a> | <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> | <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 3 章 Podman</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../docker/docker.faq.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="podman.manual.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a></td><td></td><td></td><td></td><td></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>第 3 章 Podman</h1></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#podman.install">3.1. 安装 Podman</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#id930">3.1.1. RockyLinux 安装 Podman</a></span></dt><dt><span class="section"><a href="index.html#id931">3.1.2. Almalinux 9.0</a></span></dt><dt><span class="section"><a href="index.html#id932">3.1.3. MacOS 安装 Podman</a></span></dt><dt><span class="section"><a href="index.html#id933">3.1.4. 初始化 Podman</a></span></dt><dt><span class="section"><a href="index.html#podman.docker">3.1.5. 兼容 Docker</a></span></dt><dt><span class="section"><a href="index.html#podman-compose">3.1.6. 安装 podman-compose</a></span></dt><dt><span class="section"><a href="index.html#podmain.config">3.1.7. 配置 Podman</a></span></dt></dl></dd><dt><span class="section"><a href="podman.manual.html">3.2. podman 管理</a></span></dt><dd><dl><dt><span class="section"><a href="podman.manual.html#podman.machine">3.2.1. 虚拟机管理</a></span></dt><dt><span class="section"><a href="podman.manual.html#id939">3.2.2. 镜像管理</a></span></dt><dt><span class="section"><a href="podman.manual.html#podman.run">3.2.3. 运行命令</a></span></dt></dl></dd><dt><span class="section"><a href="podman.example.html">3.3. 按例</a></span></dt><dd><dl><dt><span class="section"><a href="podman.example.html#id940">3.3.1. podman run 用法</a></span></dt><dt><span class="section"><a href="podman.example.html#id941">3.3.2. mysql</a></span></dt><dt><span class="section"><a href="podman.example.html#id942">3.3.3. 制作镜像</a></span></dt></dl></dd></dl></div>
    
    
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="podman.install"></a>3.1. 安装 Podman</h2></div></div></div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id930"></a>3.1.1. RockyLinux 安装 Podman</h3></div></div></div>
		
		<p>某些 Redhat 家族的 Linux 是自带 Podman，例如 Almalinux 9.0，RockyLinux没有自带
			podman
			需要自己安装，是方法执行下面的命令
		</p>
		<pre class="screen">
			
[root@netkiller ~]# dnf install -y podman
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id931"></a>3.1.2. Almalinux 9.0</h3></div></div></div>
		
		<p>Almalinux 9.0 自带 podman</p>
		<pre class="screen">
		 
systemctl enable podman		
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id932"></a>3.1.3. MacOS 安装 Podman</h3></div></div></div>
		
		<p>MacOS 安装方法</p>
		<pre class="screen">
			 
brew install podman
            
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id933"></a>3.1.4. 初始化 Podman</h3></div></div></div>
		
		<p>初始化，启动 Podman</p>
		<pre class="screen">
			 
podman machine init
podman machine start
            
		</pre>
		<p>操作演示</p>
		<pre class="screen">
			 
neo@MacBook-Pro-M2 ~ % podman machine init
Downloading VM image: fedora-coreos-37.20221127.2.0-qemu.aarch64.qcow2.xz: done  
Extracting compressed file Image resized.
Machine init complete
To start your machine run:

    podman machine start

neo@MacBook-Pro-M2 ~ % podman machine start          
Starting machine "podman-machine-default"
Waiting for VM ...
Mounting volume... /Users/neo:/Users/neo

This machine is currently configured in rootless mode. If your containers
require root permissions (e.g. ports &lt; 1024), or if you run into compatibility
issues with non-podman clients, you can switch using the following command: 

    podman machine set --rootful

API forwarding listening on: /Users/neo/.local/share/containers/podman/machine/podman-machine-default/podman.sock

The system helper service is not installed; the default Docker API socket
address can't be used by podman. If you would like to install it run the
following commands:

    sudo /opt/homebrew/Cellar/podman/4.3.1/bin/podman-mac-helper install
    podman machine stop; podman machine start

You can still connect Docker API clients by setting DOCKER_HOST using the
following command in your terminal session:

    export DOCKER_HOST='unix:///Users/neo/.local/share/containers/podman/machine/podman-machine-default/podman.sock'

Machine "podman-machine-default" started successfully
            
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="podman.docker"></a>3.1.5. 兼容 Docker</h3></div></div></div>
		
		<pre class="screen">
		
echo "alias docker='podman'" &gt;&gt; ~/.bashrc
source ~/.bashrc
		
		</pre>
	</div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="podman-compose"></a>3.1.6. 安装 podman-compose</h3></div></div></div>
		
		<p>安装 python 3.13</p>
		<pre class="screen">
			
[root@netkiller ~]# dnf install python3.13 python3.13-pip
[root@netkiller ~]# rm -f /usr/bin/python3
[root@netkiller ~]# ln -s /usr/bin/python3.13 /usr/bin/python3
			
		</pre>
		<pre class="screen">
			
[root@netkiller ~]# dnf install -y podman-compose
[root@netkiller ~]# pip install podman-compose
			
		</pre>
		<p>验证是否正常工作</p>
		<pre class="screen">
		
[root@netkiller ~]# podman compose 
Run compose workloads via an external provider such as docker-compose or podman-compose

Description:
  This command is a thin wrapper around an external compose provider such as docker-compose or podman-compose.  This means that podman compose is executing another tool that implements the compose functionality but sets up the environment in a way to let the compose provider communicate transparently with the local Podman socket.  The specified options as well the command and argument are passed directly to the compose provider.

The default compose providers are docker-compose and podman-compose.  If installed, docker-compose takes precedence since it is the original implementation of the Compose specification and is widely used on the supported platforms (i.e., Linux, Mac OS, Windows).

If you want to change the default behavior or have a custom installation path for your provider of choice, please change the compose_providers field in containers.conf(5) to compose_providers = ["/path/to/provider"]. You may also set the PODMAN_COMPOSE_PROVIDER environment variable.

Usage:
  podman compose [options]

Examples:
  podman compose -f nginx.yaml up --detach
  podman --log-level=debug compose -f many-images.yaml pull

&gt;&gt;&gt;&gt; Executing external compose provider "/usr/local/bin/podman-compose". Please see podman-compose(1) for how to disable this message. &lt;&lt;&lt;&lt;

usage: podman-compose [-h] [-v] [--in-pod in_pod] [--pod-args pod_args] [--env-file env_file] [-f file] [--profile profile] [-p PROJECT_NAME] [--podman-path PODMAN_PATH]
                      [--podman-args args] [--podman-pull-args args] [--podman-push-args args] [--podman-build-args args] [--podman-inspect-args args] [--podman-run-args args]
                      [--podman-start-args args] [--podman-stop-args args] [--podman-rm-args args] [--podman-volume-args args] [--no-ansi] [--no-cleanup] [--dry-run]
                      [--parallel PARALLEL] [--verbose]
                      {help,version,wait,systemd,pull,push,build,up,down,ps,run,exec,start,stop,restart,logs,config,port,pause,unpause,kill,stats,images} ...

options:
  -h, --help            show this help message and exit
  -v, --version         show version
  --in-pod in_pod       Specify pod usage:
                          'true'   - create/use a pod named pod_&lt;project name&gt;
                          'false'  - do not use a pod
                          '&lt;name&gt;' - create/use a custom pod with the given name
  --pod-args pod_args   custom arguments to be passed to `podman pod`
  --env-file env_file   Specify an alternate environment file
  -f, --file file       Specify an compose file (default: docker-compose.yml) or '-' to read from stdin.
  --profile profile     Specify a profile to enable
  -p, --project-name PROJECT_NAME
                        Specify an alternate project name (default: directory name)
  --podman-path PODMAN_PATH
                        Specify an alternate path to podman (default: use location in $PATH variable)
  --podman-args args    custom global arguments to be passed to `podman`
  --podman-pull-args args
                        custom arguments to be passed to `podman pull`
  --podman-push-args args
                        custom arguments to be passed to `podman push`
  --podman-build-args args
                        custom arguments to be passed to `podman build`
  --podman-inspect-args args
                        custom arguments to be passed to `podman inspect`
  --podman-run-args args
                        custom arguments to be passed to `podman run`
  --podman-start-args args
                        custom arguments to be passed to `podman start`
  --podman-stop-args args
                        custom arguments to be passed to `podman stop`
  --podman-rm-args args
                        custom arguments to be passed to `podman rm`
  --podman-volume-args args
                        custom arguments to be passed to `podman volume`
  --no-ansi             Do not print ANSI control characters
  --no-cleanup          Do not stop and remove existing pod &amp; containers
  --dry-run             No action; perform a simulation of commands
  --parallel PARALLEL
  --verbose             Print debugging output

command:
  {help,version,wait,systemd,pull,push,build,up,down,ps,run,exec,start,stop,restart,logs,config,port,pause,unpause,kill,stats,images}
    help                show help
    version             show version
    wait                wait running containers to stop
    systemd             create systemd unit file and register its compose stacks
    pull                pull stack images
    push                push stack images
    build               build stack images
    up                  Create and start the entire stack or some of its services
    down                tear down entire stack
    ps                  show status of containers
    run                 create a container similar to a service to run a one-off command
    exec                execute a command in a running container
    start               start specific services
    stop                stop specific services
    restart             restart specific services
    logs                show logs from services
    config              displays the compose file
    port                Prints the public port for a port binding.
    pause               Pause all running containers
    unpause             Unpause all running containers
    kill                Kill one or more running containers with a specific signal
    stats               Display percentage of CPU, memory, network I/O, block I/O and PIDs for services.
    images              List images used by the created containers		
		
		</pre>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id934"></a>3.1.6.1. 让 Podman 支持 Docker Compose(旧版本)</h4></div></div></div>
			
			<p>启用 socket</p>
			<pre class="screen">
		 
systemctl enable podman.socket
systemctl start podman.socket
systemctl status podman.socket
		
			</pre>
			<p>验证 sock 是否正常工作</p>
			<pre class="screen">
		 
[root@localhost ~]# curl -H "Content-Type: application/json" --unix-socket /run/podman/podman.sock http://localhost/_ping
OK
		
			</pre>
			<p>此时可以使用 docker compose</p>
			<pre class="screen">
		 
[root@localhost ~]# ln -s /run/podman/podman.sock /var/run/docker.sock		
		
			</pre>
		</div>
	</div>

	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="podmain.config"></a>3.1.7. 配置 Podman</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="registries.conf"></a>3.1.7.1. Registry</h4></div></div></div>
			
			<p>/etc/containers/registries.conf</p>
			<pre class="screen">
		 
mkdir -p /var/lib/registry
podman run --privileged -d --name registry -p 5000:5000 -v /var/lib/registry:/var/lib/registry --restart=always registry:2		
		
			</pre>
			<p>修改 /etc/containers/registries.conf 配置文件</p>
			<pre class="screen">
		 
registries = []
改为
registries = ['localhost:5000']		
		
			</pre>
		</div>
	</div>
</div>
    

    

</div><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../docker/docker.faq.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="podman.manual.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">2.15. Docker FAQ </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 3.2. podman 管理</td></tr></table></div><script xmlns="">
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-11694057-1', 'auto');
			ga('send', 'pageview');

		</script><script xmlns="" async="async">
			var _hmt = _hmt || [];
			(function() {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
			})();
</script><script xmlns="" async="async">
			(function(){
			var bp = document.createElement('script');
			var curProtocol = window.location.protocol.split(':')[0];
			if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
			}
			else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
			}
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(bp, s);
			})();
</script></body></html>