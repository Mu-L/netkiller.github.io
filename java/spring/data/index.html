<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 8 章 Spring Data</title><link rel="stylesheet" type="text/css" href="../../docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="home" href="../../index.html" title="Netkiller Java 手札（版）" /><link rel="up" href="../index.html" title="部分 I. Spring Framework" /><link rel="prev" href="../WebFlux/webflux.router.html" title="7.2. WebFlux Router" /><link rel="next" href="spring-data-mongodb.html" title="8.2. Spring Data with MongoDB" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
   	    <a xmlns="" href="https://edu.51cto.com/lecturer/1703915.html">51CTO学院</a> |
	    <a xmlns="" href="https://edu.csdn.net/lecturer/6423">CSDN程序员研修院</a> |
	    <a xmlns="" href="https://github.com/netkiller">Github</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://cloud.tencent.com/developer/column/2078">腾讯云社区</a> |
	    <a xmlns="" href="https://yq.aliyun.com/u/netkiller/">阿里云栖社区</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="https://www.youtube.com/user/bg7nyt/videos">Youtube</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 8 章 Spring Data</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../WebFlux/webflux.router.html">上一页</a> </td><th width="60%" align="center">部分 I. Spring Framework</th><td width="20%" align="right"> <a accesskey="n" href="spring-data-mongodb.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> ｜ <a href="https://www.zhihu.com/club/1241768772601950208">多维度架构</a></td><td></td><td></td><td></td><td></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index"></a>第 8 章 Spring Data</h2></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#spring-data-redis">8.1. Spring Data with Redis</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#springdata.redis.exmaple">8.1.1. 集成 Redis XML 方式</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm252754851232">8.1.1.1. pom.xml</a></span></dt><dt><span class="section"><a href="index.html#idm252754850336">8.1.1.2. springframework-servlet.xml</a></span></dt><dt><span class="section"><a href="index.html#idm252754851648">8.1.1.3. Controller</a></span></dt><dt><span class="section"><a href="index.html#idm252754847904">8.1.1.4. index.jsp</a></span></dt><dt><span class="section"><a href="index.html#idm252754846816">8.1.1.5. 测试</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#RedisTemplate">8.1.2. RedisTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#stringRedisTemplate">8.1.2.1. stringRedisTemplate 基本用法</a></span></dt><dt><span class="section"><a href="index.html#idm252754842672">8.1.2.2. 设置缓存时间</a></span></dt><dt><span class="section"><a href="index.html#idm252754841728">8.1.2.3. 字符串截取</a></span></dt><dt><span class="section"><a href="index.html#idm252754840720">8.1.2.4. 追加字符串</a></span></dt><dt><span class="section"><a href="index.html#idm252754839776">8.1.2.5. 设置键的字符串值并返回其旧值</a></span></dt><dt><span class="section"><a href="index.html#idm252754838928">8.1.2.6. increment</a></span></dt><dt><span class="section"><a href="index.html#delete">8.1.2.7. 删除 key </a></span></dt><dt><span class="section"><a href="index.html#size">8.1.2.8. 返回字符串长度</a></span></dt><dt><span class="section"><a href="index.html#setIfAbsent">8.1.2.9. 如果key不存便缓存。</a></span></dt><dt><span class="section"><a href="index.html#multiSet">8.1.2.10. 缓存多个值 /获取多个值 multiSet / multiGet</a></span></dt><dt><span class="section"><a href="index.html#list">8.1.2.11. List</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm252756916032">8.1.2.11.1. rightPush</a></span></dt><dt><span class="section"><a href="index.html#idm252756915120">8.1.2.11.2. rightPushAll</a></span></dt><dt><span class="section"><a href="index.html#idm252756913648">8.1.2.11.3. rightPushIfPresent</a></span></dt><dt><span class="section"><a href="index.html#idm252756912416">8.1.2.11.4. leftPush</a></span></dt><dt><span class="section"><a href="index.html#idm252756911584">8.1.2.11.5. leftPushAll</a></span></dt><dt><span class="section"><a href="index.html#idm252756909584">8.1.2.11.6. range</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#set">8.1.2.12. SET 数据类型</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm252751646704">8.1.2.12.1. 返回集合中的所有成员</a></span></dt><dt><span class="section"><a href="index.html#idm252751645968">8.1.2.12.2. 取出一个成员</a></span></dt><dt><span class="section"><a href="index.html#idm252751645232">8.1.2.12.3. 随机获取无序集合中的一个元素</a></span></dt><dt><span class="section"><a href="index.html#idm252751644432">8.1.2.12.4. 随机获取 n 个成员（存在重复数据）</a></span></dt><dt><span class="section"><a href="index.html#idm252751643552">8.1.2.12.5. 随机获取 n 个不重复成员</a></span></dt><dt><span class="section"><a href="index.html#idm252751642688">8.1.2.12.6. 在两个 SET 间移动数据</a></span></dt><dt><span class="section"><a href="index.html#idm252751641808">8.1.2.12.7. 成员删除</a></span></dt><dt><span class="section"><a href="index.html#idm252751641024">8.1.2.12.8. 返回集合数量</a></span></dt><dt><span class="section"><a href="index.html#idm252751640256">8.1.2.12.9. 判断元素是否在集合成员中</a></span></dt><dt><span class="section"><a href="index.html#idm252751639472">8.1.2.12.10. 对比两个集合求交集</a></span></dt><dt><span class="section"><a href="index.html#idm252751638064">8.1.2.12.11. 对比两个集合求交集，然后存储到新的 key 中</a></span></dt><dt><span class="section"><a href="index.html#idm252751636688">8.1.2.12.12. 合并两个集合，并去处重复数据</a></span></dt><dt><span class="section"><a href="index.html#idm252751635664">8.1.2.12.13. 合并两个集合去重复后保存到新的 key 中</a></span></dt><dt><span class="section"><a href="index.html#idm252751634752">8.1.2.12.14. 计算两个合集的差集</a></span></dt><dt><span class="section"><a href="index.html#idm252751633792">8.1.2.12.15. 计算两个合集的差集，然后保存到新的 key 中</a></span></dt><dt><span class="section"><a href="index.html#idm252751632976">8.1.2.12.16. 遍历 SET 集合</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#zset">8.1.2.13. 有序的 set 集合</a></span></dt><dt><span class="section"><a href="index.html#hash">8.1.2.14. Hash</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm252751630448">8.1.2.14.1. put</a></span></dt><dt><span class="section"><a href="index.html#idm252751629552">8.1.2.14.2. putAll</a></span></dt><dt><span class="section"><a href="index.html#idm252751628624">8.1.2.14.3. 从键中的哈希获取给定hashKey的值</a></span></dt><dt><span class="section"><a href="index.html#idm252751627840">8.1.2.14.4. delete</a></span></dt><dt><span class="section"><a href="index.html#idm252751626800">8.1.2.14.5. 确定哈希hashKey是否存在</a></span></dt><dt><span class="section"><a href="index.html#idm252751625744">8.1.2.14.6. 从哈希中获取指定的多个 hashKey 的值</a></span></dt><dt><span class="section"><a href="index.html#idm252751624848">8.1.2.14.7. 只有hashKey不存在时才能添加值</a></span></dt><dt><span class="section"><a href="index.html#idm252751624048">8.1.2.14.8. 获取整个Hash</a></span></dt><dt><span class="section"><a href="index.html#idm252751623280">8.1.2.14.9. 获取所有key</a></span></dt><dt><span class="section"><a href="index.html#idm252752940240">8.1.2.14.10. 通过 hashKey 获取所有值</a></span></dt><dt><span class="section"><a href="index.html#idm252752939456">8.1.2.14.11. 值加法操作</a></span></dt><dt><span class="section"><a href="index.html#idm252752938688">8.1.2.14.12. 遍历 Hash 表</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#redisTemplate.expire">8.1.2.15. 过期时间未执行</a></span></dt><dt><span class="section"><a href="index.html#idm252752935200">8.1.2.16. setBit / getBit 二进制位操作</a></span></dt><dt><span class="section"><a href="index.html#JsonRedisTemplate">8.1.2.17. 存储 Json 对象</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm252752932080">8.1.2.17.1. 集成 RedisTemplate 定义新类 JsonRedisTemplate</a></span></dt><dt><span class="section"><a href="index.html#idm252752931296">8.1.2.17.2. 配置 Redis</a></span></dt><dt><span class="section"><a href="index.html#idm252752930656">8.1.2.17.3. 测试</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="index.html#RedisRepository">8.1.3. Spring Data Redis - Repository Examples</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm252752929408">8.1.3.1. @EnableRedisRepositories 启动 Redis 仓库</a></span></dt><dt><span class="section"><a href="index.html#idm252752928368">8.1.3.2. 定义 Domain 类</a></span></dt><dt><span class="section"><a href="index.html#idm252752926480">8.1.3.3. Repository 接口</a></span></dt><dt><span class="section"><a href="index.html#idm252752925056">8.1.3.4. 测试代码</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html">8.2. Spring Data with MongoDB</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#SpringDataMongoDB">8.2.1. Example Spring Data MongoDB</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252752922032">8.2.1.1. pom.xml</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752920704">8.2.1.2. springframework-servlet.xml</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752918000">8.2.1.3. POJO</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752917344">8.2.1.4. Controller</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752915776">8.2.1.5. 查看测试结果</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752914816">8.2.1.6. 条件查询</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#idm252752913856">8.2.2. MongoDB 多数据源</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252752913472">8.2.2.1. Maven</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752912592">8.2.2.2. Application 禁止自动配置 MongoDB</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752910784">8.2.2.3. application.properties 新增配置项</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752909936">8.2.2.4. MongoDB 配置类</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752908272">8.2.2.5. 创建 Document 关系映射类 </a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752907584">8.2.2.6. 测试控制器</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252753917984">8.2.2.7. 测试</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#@Document">8.2.3. @Document</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#@Document">8.2.3.1. 指定表名</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#@Id">8.2.3.2. @Id</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#@Version">8.2.3.3. @Version</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#@Field">8.2.3.4. @Field 定义字段名</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#@Indexed">8.2.3.5. @Indexed</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252751622288">8.2.3.5.1. 普通索引</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252774035920">8.2.3.5.2. 唯一索引</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752568256">8.2.3.5.3. 索引排序方式</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752547504">8.2.3.5.4. 稀疏索引</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752546384">8.2.3.5.5. 索引过期时间设置</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#@CompoundIndex">8.2.3.6. @CompoundIndex 复合索引</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252752545008">8.2.3.6.1. 普通复合索引</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252752898384">8.2.3.6.2. 唯一复合索引</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#@TextIndexed">8.2.3.7. @TextIndexed</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#@GeoSpatialIndex">8.2.3.8. @GeoSpatialIndex 地理位置索引</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#@Transient">8.2.3.9. @Transient 丢弃数据，不存到 mongodb</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#@DBRef">8.2.3.10. @DBRef 做外外键引用</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252754829552">8.2.3.10.1. Article 类</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252754828800">8.2.3.10.2. Hypermedia 类</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252754826576">8.2.3.10.3. MongoRepository</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252754825168">8.2.3.10.4. RestController</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#idm252754824512">8.2.3.10.5. 运行结果</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#DateTimeFormat">8.2.3.11. @DateTimeFormat</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#NumberFormat">8.2.3.12. @NumberFormat</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Enum">8.2.3.13. 在 @Document 中使用 Enum 类型</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#document.list">8.2.3.14. 在 @Document 中定义数据结构 List/Map</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongodb.geojson">8.2.3.15. GeoJson 数据类型</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#MongoRepository">8.2.4. MongoRepository</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252752890224">8.2.4.1. 扫描仓库接口</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#findAll">8.2.4.2. findAll()</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#deleteAll">8.2.4.3. deleteAll()</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#save">8.2.4.4. save()</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#count">8.2.4.5. count()</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Repository.exists">8.2.4.6. exists() 判断是否存在</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#existsById">8.2.4.7. existsById()</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#findByXXXX">8.2.4.8. findByXXXX</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#findAllOrderBy">8.2.4.9. findAll with OrderBy</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252754813088">8.2.4.9.1. order by boolean 布尔型数据排序</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#findsort">8.2.4.10. findAll with Sort</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#findpage">8.2.4.11. FindAll with Pageable</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#PageRequest">8.2.4.11.1. PageRequest - springboot 1.x 旧版本</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#StartingWith">8.2.4.12. StartingWith 和 EndingWith</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Between">8.2.4.13. Between</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Before.After">8.2.4.14. Before / After</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#@Query">8.2.4.15. @Query</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate">8.2.5. mongoTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.save">8.2.5.1. Save 保存</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.insert">8.2.5.2. Insert</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.updateFirst">8.2.5.3. updateFirst 修改符合条件第一条记录</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.updateMulti">8.2.5.4. updateMulti 修改符合条件的所有</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.findAndModify">8.2.5.5. 查找并保存</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.upsert">8.2.5.6. upsert - 修改符合条件时如果不存在则添加</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.remove">8.2.5.7. 删除</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.findOne">8.2.5.8. 查找一条数据</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.find">8.2.5.9. 查找所有数据</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.query">8.2.5.10. Query</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#query.skip.limit">8.2.5.10.1. 翻页</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#between">8.2.5.10.2. between</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#Criteria">8.2.5.11. Criteria</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#Criteria.is">8.2.5.11.1. is</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Criteria.regex">8.2.5.11.2. Regex 正则表达式搜索</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Criteria.ltgt">8.2.5.11.3. lt 和 gt</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Criteria.exists">8.2.5.11.4. exists()</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Criteria.in">8.2.5.11.5. 包含</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#Update">8.2.5.12. Update</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#Update.set">8.2.5.12.1. set</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Update.push">8.2.5.12.2. 追加数据</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Update.update">8.2.5.12.3. 更新数据</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Update.unset">8.2.5.12.4. 删除数据</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Update.inc">8.2.5.12.5. inc</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#Update.addToSet">8.2.5.12.6. update.addToSet</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#BasicUpdate">8.2.5.13. BasicUpdate</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#sort">8.2.5.14. Sort</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#PageRequest">8.2.5.15. Query + PageRequest</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#newAggregation">8.2.5.16. newAggregation</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#indexOps">8.2.5.17. 创建索引</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#mongoTemplate.subobject">8.2.5.18. 子对象操作</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252841888112">8.2.5.18.1. List 类型</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="spring-data-mongodb.html#GeoJsonDeserializer">8.2.6. GeoJson 反序列化</a></span></dt><dt><span class="section"><a href="spring-data-mongodb.html#springbot.mongodb.faq">8.2.7. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-mongodb.html#idm252841881216">8.2.7.1. location object expected, location array not in correct format; nested exception is com.mongodb.MongoWriteException: location object expected, location array not in correct format</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="spring-data-jpa.html">8.3. Spring Data with MySQL</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#engine">8.3.1. 选择数据库表引擎</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#@Entity">8.3.2. 声明实体</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#idm252841876928">8.3.2.1. @Entity 声明实体</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#@Table">8.3.2.2. @Table 定义表名</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#catalog">8.3.2.2.1. catalog</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#schema">8.3.2.2.2. schema</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#uniqueConstraints">8.3.2.2.3. uniqueConstraints</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#@Id">8.3.2.3. @Id 定义主键</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#@Column">8.3.2.4. @Column 定义字段</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#idm252841866576">8.3.2.4.1. 字段长度</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252841865472">8.3.2.4.2. 浮点型</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252841864640">8.3.2.4.3. 创建于更新控制</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252841863856">8.3.2.4.4. TEXT 类型</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#UNSIGNED">8.3.2.4.5. 整形数据类型</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#@Lob">8.3.2.5. @Lob 注解属性将被持久化为 Blog 或 Clob 类型</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#@NotNull">8.3.2.6. @NotNull 不能为空声明</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#@Temporal">8.3.2.7. @Temporal 日期定义</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#DateTimeFormat">8.3.2.8. @DateTimeFormat 处理日期时间格式</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#time">8.3.2.9. 默认时间规则</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#CreatedDate">8.3.2.9.1. CreatedDate</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252841852288">8.3.2.9.2. 与时间日期有关的 hibernate 注解</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252841848032">8.3.2.9.3. 数据库级别的默认创建日期时间定义</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252841846080">8.3.2.9.4. 数据库级别的默认创建日期与更新时间定义</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252749550240">8.3.2.9.5. 最后修改时间</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#enum">8.3.2.10. Enum 枚举数据类型</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#idm252749547520">8.3.2.10.1. 实体中处理 enum 类型</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252749543696">8.3.2.10.2. 数据库枚举类型</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#set">8.3.2.11. SET 数据结构</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#json">8.3.2.12. JSON 数据类型</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#index">8.3.2.13. 索引</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#idm252750583584">8.3.2.13.1. 普通索引</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#unique">8.3.2.13.2. 唯一索引</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#uniqueConstraints">8.3.2.13.3. 复合索引</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#@Embeddable">8.3.2.14. 创建复合主键</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#JoinColumn">8.3.2.15. @JoinColumn</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#OneToOne">8.3.2.16. @OneToOne</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#OneToMany">8.3.2.17. OneToMany 一对多</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#ManyToMany">8.3.2.18. ManyToMany 多对多</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#orphanRemoval">8.3.2.19. 外键级联删除</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750559984">8.3.2.20. 其他</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#Cascade">8.3.2.20.1. Cascade</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750558352">8.3.2.20.2. @JsonIgnore</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#@EnableJpaAuditing">8.3.2.20.3. @EnableJpaAuditing 开启 JPA 审计功能</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#Inheritance">8.3.3. 实体继承</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#Repository">8.3.4. Repository</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#CrudRepository">8.3.4.1. CrudRepository</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#JpaRepository">8.3.4.2. JpaRepository</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#jpa.find">8.3.4.3. findByXXX</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#idm252750544736">8.3.4.3.1. 传 Boolean 参数</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#eunm">8.3.4.3.2. Eunm 传递枚举参数</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#jpa.count">8.3.4.4. count 操作</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#OrderBy">8.3.4.5. OrderBy</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#GreaterThan">8.3.4.6. GreaterThan</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#pageable">8.3.4.7. PageRequest 翻页操作</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#idm252750536160">8.3.4.7.1. PageRequest.of</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750533456">8.3.4.7.2. Pageable</a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#sort">8.3.4.8. Sort 排序操作操作</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#Query">8.3.4.9. Query</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#idm252750528736">8.3.4.9.1. 参数传递</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750526560">8.3.4.9.2. 原生 SQL</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750524832">8.3.4.9.3. @Query 与 Pageagble</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750521904">8.3.4.9.4. 返回指定字段</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750520704">8.3.4.9.5. 返回指定的模型</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#Transactional">8.3.5. 事务 @Transactional</a></span></dt><dd><dl><dt><span class="section"><a href="spring-data-jpa.html#idm252750517920">8.3.5.1. 删除更新需要 @Transactional 注解</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750517280">8.3.5.2. 回滚操作</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750515344">8.3.5.3. private、default、protected 和 final 不支持事物 </a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750514144">8.3.5.4. Service 注意事项</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750511968">8.3.5.5. 需要 @Service 注解配合使用</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#idm252750510368">8.3.5.6. </a></span></dt></dl></dd><dt><span class="section"><a href="spring-data-jpa.html#TransactionTemplate">8.3.6. TransactionTemplate</a></span></dt><dt><span class="section"><a href="spring-data-jpa.html#@Lock">8.3.7. 锁 @Lock</a></span></dt></dl></dd><dt><span class="section"><a href="EntityManager.html">8.4. EntityManager</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html">8.5. Spring Data with JdbcTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="JdbcTemplate.html#execute">8.5.1. execute</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#queryForInt">8.5.2. queryForInt</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#jdbcTemplate.queryForLong">8.5.3. queryForLong</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#queryForObject">8.5.4. queryForObject</a></span></dt><dd><dl><dt><span class="section"><a href="JdbcTemplate.html#idm252750500672">8.5.4.1. 返回整形与字符型</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750499760">8.5.4.2. 查询 Double 类型数据库</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750498672">8.5.4.3. 返回日期</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750497232">8.5.4.4. 返回结果集</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750496048">8.5.4.5. 通过 "?" 向SQL传递参数</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750495376">8.5.4.6. RowMapper 记录映射</a></span></dt></dl></dd><dt><span class="section"><a href="JdbcTemplate.html#queryForList">8.5.5. queryForList</a></span></dt><dd><dl><dt><span class="section"><a href="JdbcTemplate.html#idm252750491664">8.5.5.1. Iterator 用法</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750490416">8.5.5.2. for 循环</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750489136">8.5.5.3. forEach 用法</a></span></dt></dl></dd><dt><span class="section"><a href="JdbcTemplate.html#queryForMap">8.5.6. queryForMap</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#query">8.5.7. query</a></span></dt><dd><dl><dt><span class="section"><a href="JdbcTemplate.html#idm252750486704">8.5.7.1. ResultSet</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750485680">8.5.7.2. ResultSetExtractor</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#idm252750484272">8.5.7.3. RowMapper</a></span></dt></dl></dd><dt><span class="section"><a href="JdbcTemplate.html#queryForRowSet">8.5.8. queryForRowSet</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#update">8.5.9. update</a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#">8.5.10. </a></span></dt><dt><span class="section"><a href="JdbcTemplate.html#jdbc.example">8.5.11. 实例参考</a></span></dt><dd><dl><dt><span class="section"><a href="JdbcTemplate.html#">8.5.11.1. 参数传递技巧</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="elasticsearch.html">8.6. Spring Data with Elasticsearch</a></span></dt><dd><dl><dt><span class="section"><a href="elasticsearch.html#idm252750475984">8.6.1. 内嵌 Elasticsearch</a></span></dt><dd><dl><dt><span class="section"><a href="elasticsearch.html#idm252750475072">8.6.1.1. Maven</a></span></dt><dt><span class="section"><a href="elasticsearch.html#idm252750473440">8.6.1.2. src/main/resources/application.properties</a></span></dt><dt><span class="section"><a href="elasticsearch.html#idm252750472304">8.6.1.3. Domain Class</a></span></dt><dt><span class="section"><a href="elasticsearch.html#idm252750471648">8.6.1.4. ElasticsearchRepository</a></span></dt><dt><span class="section"><a href="elasticsearch.html#idm252750470224">8.6.1.5. SearchRestController</a></span></dt><dt><span class="section"><a href="elasticsearch.html#idm252750469552">8.6.1.6. 测试</a></span></dt></dl></dd><dt><span class="section"><a href="elasticsearch.html#idm252750468496">8.6.2. 集群模式</a></span></dt><dt><span class="section"><a href="elasticsearch.html#idm252750466704">8.6.3. Document</a></span></dt><dt><span class="section"><a href="elasticsearch.html#idm252750465936">8.6.4. Elasticsearch 删除操作</a></span></dt><dt><span class="section"><a href="elasticsearch.html#faq">8.6.5. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="elasticsearch.html#idm252750464656">8.6.5.1. java.lang.IllegalStateException: Received message from unsupported version: [2.0.0] minimal compatible version is: [5.0.0]</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="faq.html">8.7. Spring Data FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="faq.html#idm252750463200">8.7.1. No identifier specified for entity</a></span></dt><dt><span class="section"><a href="faq.html#idm252750462608">8.7.2. Oracle Date 类型显示日期和时间</a></span></dt><dt><span class="section"><a href="faq.html#idm252750461920">8.7.3. java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.Integer</a></span></dt><dt><span class="section"><a href="faq.html#idm252750459696">8.7.4. Executing an update/delete query; nested exception is javax.persistence.TransactionRequiredException: Executing an update/delete query</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="spring-data-redis"></a>8.1. Spring Data with Redis</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="springdata.redis.exmaple"></a>8.1.1. 集成 Redis XML 方式</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754851232"></a>8.1.1.1. pom.xml</h4></div></div></div><pre class="screen">
		
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-redis&lt;/artifactId&gt;
		&lt;/dependency&gt;			
		
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754850336"></a>8.1.1.2. springframework-servlet.xml</h4></div></div></div><pre class="screen">
		
	&lt;!-- Redis Connection Factory --&gt;
	&lt;bean id="jedisConnFactory"
		class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"
		p:host-name="192.168.2.1" p:port="6379" p:use-pool="true" /&gt;

	&lt;!-- redis redisTemplate definition --&gt;
	&lt;bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate"
		p:connection-factory-ref="jedisConnFactory" /&gt;
		
			</pre><div class="example"><a id="idm252754849264"></a><p class="title"><strong>例 8.1. Spring Data Redis Example</strong></p><div class="example-contents"><pre class="screen">
			
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="
        http://www.springframework.org/schema/beans     
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc 
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context 
        http://www.springframework.org/schema/context/spring-context.xsd"&gt;

	&lt;mvc:resources location="/images/" mapping="/images/**" /&gt;
	&lt;mvc:resources location="/css/" mapping="/css/**" /&gt;

	&lt;context:component-scan base-package="cn.netkiller.controller" /&gt;

	&lt;mvc:annotation-driven /&gt;

	&lt;bean
		class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
		&lt;property name="viewClass"
			value="org.springframework.web.servlet.view.JstlView" /&gt;
		&lt;property name="prefix" value="/WEB-INF/jsp/" /&gt;
		&lt;property name="suffix" value=".jsp" /&gt;
		&lt;!-- &lt;property name="viewNames" value="*.jsp" /&gt; --&gt;
	&lt;/bean&gt;

	&lt;bean id="configuracion"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
		&lt;property name="location" value="classpath:resources/development.properties" /&gt;
	&lt;/bean&gt;

	&lt;bean id="dataSource"
		class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
		&lt;property name="driverClassName" value="${jdbc.driverClassName}" /&gt;
		&lt;property name="url" value="${jdbc.url}" /&gt;
		&lt;property name="username" value="${jdbc.username}" /&gt;
		&lt;property name="password" value="${jdbc.password}" /&gt;
	&lt;/bean&gt;

	&lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt;
		&lt;property name="dataSource" ref="dataSource" /&gt;
	&lt;/bean&gt;
	&lt;bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt;
		&lt;property name="basePackage" value="cn.netkiller.mapper" /&gt;
	&lt;/bean&gt;

	&lt;bean id="userService" class="cn.netkiller.service.UserService"&gt;
	&lt;/bean&gt;

	&lt;!-- Redis Connection Factory --&gt;
	&lt;bean id="jedisConnFactory"
		class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"
		p:host-name="192.168.2.1" p:port="6379" p:use-pool="true" /&gt;

	&lt;!-- redis redisTemplate definition --&gt;
	&lt;bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate"
		p:connection-factory-ref="jedisConnFactory" /&gt;
&lt;/beans&gt;				
			
				</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754851648"></a>8.1.1.3. Controller</h4></div></div></div><pre class="screen">
		
package cn.netkiller.controller;

import javax.annotation.Resource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.ListOperations;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.StringRedisSerializer;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;

import cn.netkiller.model.User;

@Controller
public class CacheController {

	// inject the actual redisTemplate
	@Autowired
	private RedisTemplate&lt;String, String&gt; redisTemplate;

	// inject the redisTemplate as ListOperations
	@Resource(name = "redisTemplate")
	private ListOperations&lt;String, String&gt; listOps;

	@RequestMapping("/cache")
	public ModelAndView cache() {

		String message = "";

		User user = new User();
		user.setId("1");
		user.setName("Neo");
		user.setAge(30);

		String key = "user";
		listOps.leftPush(key, user.toString());
		message = listOps.leftPop(key);

		redisTemplate.setKeySerializer(new StringRedisSerializer());
		redisTemplate.setValueSerializer(new StringRedisSerializer());
		redisTemplate.opsForValue().set("key", user.toString());

		return new ModelAndView("index/index", "variable", message);
	}
}
		
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754847904"></a>8.1.1.4. index.jsp</h4></div></div></div><pre class="screen">
		
&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;br&gt;
	&lt;div style="text-align:center"&gt;
		&lt;h2&gt;
			${variable}
		&lt;/h2&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;			
		
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754846816"></a>8.1.1.5. 测试</h4></div></div></div><p>请求URL http://your.domain.com/your.html</p><pre class="screen">
		
[root@master ~]# redis-cli 
redis 127.0.0.1:6379&gt; keys *
1) "\xac\xed\x00\x05t\x00\x04user"
2) "key"

redis 127.0.0.1:6379&gt; get key
"\xac\xed\x00\x05t\x00\x1dUser [id=1, name=Neo, age=30]"
		
			</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[提示]" src="/graphics/tip.png" /></td><th align="left">提示</th></tr><tr><td align="left" valign="top"><p>Spring Redis 默认使用 Byte数据类型存储Key，在redis-cli中会看到 "\xac\xed\x00\x05t\x00\x04" 前缀不方便get操作，所以我们会设置使用字符串，通过 redisTemplate.setKeySerializer(new StringRedisSerializer()); 实现 </p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="RedisTemplate"></a>8.1.2. RedisTemplate</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="stringRedisTemplate"></a>8.1.2.1. stringRedisTemplate 基本用法</h4></div></div></div><pre class="screen">
			
stringRedisTemplate.opsForValue().set("test", "100",60*10,TimeUnit.SECONDS);	//向redis里存入数据和设置缓存时间
stringRedisTemplate.opsForValue().get("test")									//根据key获取缓存中的val
stringRedisTemplate.getExpire("test")											//根据key获取过期时间
stringRedisTemplate.getExpire("test",TimeUnit.SECONDS)							//根据key获取过期时间并换算成指定单位
stringRedisTemplate.delete("test");												//根据key删除缓存
stringRedisTemplate.hasKey("546545");											//检查key是否存在，返回boolean值
stringRedisTemplate.expire("test",1000 , TimeUnit.MILLISECONDS);				//设置过期时间	
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754842672"></a>8.1.2.2. 设置缓存时间</h4></div></div></div><pre class="programlisting">
			
例子：设置 name 缓存 10 秒

redisTemplate.opsForValue().set("name","neo",10, TimeUnit.SECONDS);
redisTemplate.opsForValue().get("name")

结果：由于设置的是10秒失效，十秒之内查询有结果，十秒之后返回为null			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754841728"></a>8.1.2.3. 字符串截取</h4></div></div></div><pre class="programlisting">
			
设置：redisTemplate.opsForValue().set("hello","Helloworld");
代码：System.out.println(redisTemplate.opsForValue().get("hello",0,5));
结果：Hellow
代码：System.out.println(redisTemplate.opsForValue().get("hello",0,-1));
结果：Helloworld
代码：System.out.println(redisTemplate.opsForValue().get("hello",-3,-1));
结果：rld			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754840720"></a>8.1.2.4. 追加字符串</h4></div></div></div><pre class="programlisting">
			
redisTemplate.opsForValue().append("hello","Hello");
System.out.println(redisTemplate.opsForValue().get("hello"));

redisTemplate.opsForValue().append("hello","world");
System.out.println(redisTemplate.opsForValue().get("hello")); // 结果：Helloworld        			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754839776"></a>8.1.2.5. 设置键的字符串值并返回其旧值</h4></div></div></div><pre class="programlisting">
			
	redisTemplate.opsForValue().set("name","neo");
    System.out.println(redisTemplate.opsForValue().getAndSet("name","Jerry"));
	// 结果 neo			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252754838928"></a>8.1.2.6. increment</h4></div></div></div><pre class="screen">
			
stringRedisTemplate.opsForValue().set("test", "100");							//向redis里存入数据			
stringRedisTemplate.boundValueOps("test").increment(-50);						//val做-60操作
stringRedisTemplate.boundValueOps("test").increment(100);						//val +100
stringRedisTemplate.opsForValue().get("test")									//根据key获取缓存中的val		
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="delete"></a>8.1.2.7. 删除 key </h4></div></div></div><pre class="programlisting">
		
	private void cleanNewToday() {
		long begin = System.currentTimeMillis();
        
		redisTemplate.delete("news:today");
    
        long end = System.currentTimeMillis();
		logger.info("Schedule clean redis {} 耗时 {} 秒", "cleanNewFlash()", (end-begin) / 1000 );
	}
		
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="size"></a>8.1.2.8. 返回字符串长度</h4></div></div></div><pre class="programlisting">
			
redisTemplate.opsForValue().set("key","hello world");
System.out.println(redisTemplate.opsForValue().size("key"));			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="setIfAbsent"></a>8.1.2.9. 如果key不存便缓存。</h4></div></div></div><pre class="programlisting">
			
System.out.println(redisTemplate.opsForValue().setIfAbsent("name","neo"));	// name 之前已经存在 false
System.out.println(redisTemplate.opsForValue().setIfAbsent("age","11"));		// age 之前不存在	true
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="multiSet"></a>8.1.2.10. 缓存多个值 /获取多个值 multiSet / multiGet</h4></div></div></div><pre class="programlisting">
			
Map&lt;String,String&gt; maps = new HashMap&lt;String, String&gt;();
	maps.put("multi1","multi1");
	maps.put("multi2","multi2");
	maps.put("multi3","multi3");

redisTemplate.opsForValue().multiSet(maps);

List&lt;String&gt; keys = new ArrayList&lt;String&gt;();
	keys.add("multi1");
	keys.add("multi2");
	keys.add("multi3");

System.out.println(redisTemplate.opsForValue().multiGet(keys));			
			
			</pre><p>输出结果</p><pre class="screen">
			
[multi1, multi2, multi3]			
			
			</pre><p>为多个键分别设置它们的值，如果存在则返回false，不存在返回true</p><pre class="programlisting">
			
Map&lt;String,String&gt; maps = new HashMap&lt;String, String&gt;();
        maps.put("multi11","multi11");
        maps.put("multi22","multi22");
        maps.put("multi33","multi33");
Map&lt;String,String&gt; maps2 = new HashMap&lt;String, String&gt;();
        maps2.put("multi1","multi1");
        maps2.put("multi2","multi2");
        maps2.put("multi3","multi3");

System.out.println(redisTemplate.opsForValue().multiSetIfAbsent(maps)); 	// 返回 true
System.out.println(redisTemplate.opsForValue().multiSetIfAbsent(maps2));	// 返回 false
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="list"></a>8.1.2.11. List</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252756916032"></a>8.1.2.11.1. rightPush</h5></div></div></div><pre class="programlisting">
			
ListOperations&lt;String, Object&gt; list = redisTemplate.opsForList();
list.rightPush("books", "Linux");
list.rightPush("books", "Java");
System.out.println(list.range("books", 0, 1));

System.out.println(redisTemplate.opsForList().size("list"));
			
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252756915120"></a>8.1.2.11.2. rightPushAll</h5></div></div></div><pre class="programlisting">
				
		String[] stringarrays = new String[]{"1","2","3"};
        redisTemplate.opsForList().rightPushAll("listarrayright",stringarrays);
        System.out.println(redisTemplate.opsForList().range("listarrayright",0,-1));				
				
				</pre><pre class="programlisting">
				
		List&lt;Object&gt; strings = new ArrayList&lt;Object&gt;();
        strings.add("1");
        strings.add("2");
        strings.add("3");
        redisTemplate.opsForList().rightPushAll("listcollectionright", strings);
        System.out.println(redisTemplate.opsForList().range("listcollectionright",0,-1));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252756913648"></a>8.1.2.11.3. rightPushIfPresent</h5></div></div></div><pre class="programlisting">
				
		System.out.println("========== KEY 不存在===========");
		System.out.println(redisTemplate.opsForList().rightPushIfPresent("rightPushIfPresent","aa"));
        System.out.println(redisTemplate.opsForList().rightPushIfPresent("rightPushIfPresent","bb"));
        System.out.println("========== KEY 已经存在===========");
        System.out.println(redisTemplate.opsForList().rightPushIfPresent("rightPushIfPresent","aa"));
        System.out.println(redisTemplate.opsForList().rightPushIfPresent("rightPushIfPresent","bb"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252756912416"></a>8.1.2.11.4. leftPush</h5></div></div></div><pre class="programlisting">
			
redisTemplate.opsForList().leftPush("list","java");
redisTemplate.opsForList().leftPush("list","python");
redisTemplate.opsForList().leftPush("list","c++");			
			
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252756911584"></a>8.1.2.11.5. leftPushAll</h5></div></div></div><p>批量把一个数组插入到列表中</p><pre class="programlisting">
				
	String[] stringarrays = new String[]{"1","2","3"};
    redisTemplate.opsForList().leftPushAll("listarray",stringarrays);	
				
				</pre><p>批量把一个集合插入到列表中</p><pre class="programlisting">
			
使用：List&lt;Object&gt; strings = new ArrayList&lt;Object&gt;();
        strings.add("1");
        strings.add("2");
        strings.add("3");
        redisTemplate.opsForList().leftPushAll("listcollection", strings);
        System.out.println(redisTemplate.opsForList().range("listcollection",0,-1));
结果:[3, 2, 1]			
			
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252756909584"></a>8.1.2.11.6. range</h5></div></div></div><pre class="programlisting">
			
    System.out.println(redisTemplate.opsForList().range("listarray",0,-1));
	// 结果:[3, 2, 1]				
			
				</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="set"></a>8.1.2.12. SET 数据类型</h4></div></div></div><p>Redis的Set是无序集合并且集合成员是唯一的，这就意味着集合中不能出现重复的数据。</p><pre class="screen">
			
stringRedisTemplate.opsForSet().add("test", "1","2","3");						//向指定key中存放set集合
stringRedisTemplate.opsForSet().isMember("test", "1")							//根据key查看集合中是否存在指定数据
stringRedisTemplate.opsForSet().members("test");								//根据key获取set集合				
			
			</pre><pre class="programlisting">
		
//添加 一个 set 集合
SetOperations&lt;String, Object&gt; set = redisTemplate.opsForSet();
set.add("Member", "neo");
set.add("Member", "36");
set.add("Member", "178cm");
//输出 set 集合
System.out.println(set.members("Member"));	
		
			</pre><pre class="programlisting">
		
package cn.netkiller.api.restful;

import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import common.pojo.ResponseRestful;

@RestController
@RequestMapping("/news")
public class NewsRestController {

	@Autowired
	private RedisTemplate&lt;String, String&gt; redisTemplate;

	@RequestMapping(value = "/flash/{count}")
	public ResponseRestful flash(@PathVariable("count") long count) {
		if(count == 0L) {
			count=10L;
		}
		Set&lt;String&gt; news = this.redisTemplate.opsForZSet().reverseRange("news:flash", 0, count);
		if (news == null) {
			return new ResponseRestful(false, 10, "没有查询到结果", news);
		}
		return new ResponseRestful(true, 0, "返回数据: " + news.size() + " 条", news);
	}
	
	public void addRecentUser(long userId, String name) {  
	    String key = RedisKeyGenerator.genRecentBrowsingPositionsKey(String.valueOf(userId));  
	    // 获取已缓存的最近浏览的职位  
	    ZSetOperations&lt;String, String&gt; zSetOperations = redisTempalte.opsForZSet();  
        //zset内部是按分数来排序的，这里用当前时间做分数  
	    zSetOperations.add(key, name, System.currentTimeMillis());  
	    zSetOperations.removeRange(key, 0, -6);  
	}  
	
}
		
			</pre><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751646704"></a>8.1.2.12.1. 返回集合中的所有成员</h5></div></div></div><pre class="programlisting">
				
System.out.println(redisTemplate.opsForSet().members("setTest"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751645968"></a>8.1.2.12.2. 取出一个成员</h5></div></div></div><pre class="programlisting">
				
System.out.println(redisTemplate.opsForSet().pop("setTest"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751645232"></a>8.1.2.12.3. 随机获取无序集合中的一个元素</h5></div></div></div><pre class="programlisting">
				
System.out.println("Random member: " + redisTemplate.opsForSet().randomMember("setTest"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751644432"></a>8.1.2.12.4. 随机获取 n 个成员（存在重复数据）</h5></div></div></div><pre class="programlisting">
				
System.out.println("Random member: " + redisTemplate.opsForSet().randomMembers("setTest",5));
// 结果 Random member: [ccc, ddd, ddd, ddd, aaa]				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751643552"></a>8.1.2.12.5. 随机获取 n 个不重复成员</h5></div></div></div><pre class="programlisting">
				
System.out.println("Random members: " + redisTemplate.opsForSet().distinctRandomMembers("setTest",5));
//结果 Random members: [aaa, bbb, ddd, ccc]				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751642688"></a>8.1.2.12.6. 在两个 SET 间移动数据</h5></div></div></div><pre class="programlisting">
				
	redisTemplate.opsForSet().move("key1","aaa","key2");
	System.out.println(redisTemplate.opsForSet().members("key1"));
    System.out.println(redisTemplate.opsForSet().members("key2"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751641808"></a>8.1.2.12.7. 成员删除</h5></div></div></div><pre class="programlisting">
				
String[] arrays = new String[]{"Java","PHP"};
System.out.println(redisTemplate.opsForSet().remove("setTest",arrays));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751641024"></a>8.1.2.12.8. 返回集合数量</h5></div></div></div><pre class="programlisting">
				
System.out.println(redisTemplate.opsForSet().size("setTest"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751640256"></a>8.1.2.12.9. 判断元素是否在集合成员中</h5></div></div></div><pre class="programlisting">
				
ystem.out.println(redisTemplate.opsForSet().isMember("setTest","Linux"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751639472"></a>8.1.2.12.10. 对比两个集合求交集</h5></div></div></div><pre class="programlisting">
				
	System.out.println(redisTemplate.opsForSet().members("key"));
    System.out.println(redisTemplate.opsForSet().members("otherKey"));
    System.out.println(redisTemplate.opsForSet().intersect("key","otherKey"));				
				
				</pre><pre class="programlisting">
				
        List&lt;String&gt; library2 = new ArrayList&lt;String&gt;();
        library2.add("Linux");
        library2.add("FreeBSD");
        System.out.println(redisTemplate.opsForSet().intersect("library1",library2));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751638064"></a>8.1.2.12.11. 对比两个集合求交集，然后存储到新的 key 中</h5></div></div></div><pre class="programlisting">
				
System.out.println(redisTemplate.opsForSet().intersectAndStore("key","otherKey","destKey"));				
				
				</pre><pre class="programlisting">
				
		List&lt;String&gt; otherKey = new ArrayList&lt;String&gt;();
        otherKey.add("《Netkiller Java 手札》");
        otherKey.add("《Netkiller Spring Cloud 手札》");
        System.out.println(redisTemplate.opsForSet().intersectAndStore("key",otherKey,"destKey"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751636688"></a>8.1.2.12.12. 合并两个集合，并去处重复数据</h5></div></div></div><pre class="programlisting">
				
	System.out.println(redisTemplate.opsForSet().union("setTest1","setTest2"));
	
	List&lt;String&gt; otherKey = new ArrayList&lt;String&gt;();
    otherKey.add("《Netkiller Java 手札》");
    otherKey.add("《Netkiller Spring Cloud 手札》");
    System.out.println(redisTemplate.opsForSet().union("setTest",otherKey));		
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751635664"></a>8.1.2.12.13. 合并两个集合去重复后保存到新的 key 中</h5></div></div></div><pre class="programlisting">
				
	System.out.println(redisTemplate.opsForSet().unionAndStore("key","otherKey","destKey"));
	System.out.println(redisTemplate.opsForSet().unionAndStore("key",otherKey,"destKey"));					
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751634752"></a>8.1.2.12.14. 计算两个合集的差集</h5></div></div></div><pre class="programlisting">
				
	System.out.println(redisTemplate.opsForSet().difference("key","otherKey"));		
	
	List&lt;String&gt; otherKey = new ArrayList&lt;String&gt;();
    otherKey.add("setTest2");
    otherKey.add("setTest3");
    System.out.println(redisTemplate.opsForSet().difference("key",otherKey));		
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751633792"></a>8.1.2.12.15. 计算两个合集的差集，然后保存到新的 key 中</h5></div></div></div><pre class="programlisting">
				
	System.out.println(redisTemplate.opsForSet().differenceAndStore("key","otherKey","destKey"));
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751632976"></a>8.1.2.12.16. 遍历 SET 集合</h5></div></div></div><pre class="programlisting">
				
	Cursor&lt;Object&gt; curosr = redisTemplate.opsForSet().scan("setTest", ScanOptions.NONE);
    while(curosr.hasNext()){
        System.out.println(curosr.next());
    }				
				
				</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="zset"></a>8.1.2.13. 有序的 set 集合</h4></div></div></div><pre class="programlisting">
			
//添加有序的 set 集合
ZSetOperations&lt;String, Object&gt; zset = redisTemplate.opsForZSet();
zset.add("zMember", "neo", 0);
zset.add("zMember", "36", 1);
zset.add("zMember", "178cm", 2);
//输出有序 set 集合
System.out.println(zset.rangeByScore("zMember", 0, 2));				
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="hash"></a>8.1.2.14. Hash</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751630448"></a>8.1.2.14.1. put</h5></div></div></div><pre class="programlisting">
				
	redisTemplate.opsForHash().put("redisHash","name","neo");
    redisTemplate.opsForHash().put("redisHash","age",30);
    redisTemplate.opsForHash().put("redisHash","nickname","netkiller");				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751629552"></a>8.1.2.14.2. putAll</h5></div></div></div><pre class="programlisting">
				
HashOperations&lt;String, Object, Object&gt;  hash = redisTemplate.opsForHash();
Map&lt;String,Object&gt; map = new HashMap&lt;String,Object&gt;();
map.put("name", "neo");
map.put("age", "36");
hash.putAll("member", map);

System.out.println(hash.entries("member"));		
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751628624"></a>8.1.2.14.3. 从键中的哈希获取给定hashKey的值</h5></div></div></div><pre class="programlisting">
				
	System.out.println(redisTemplate.opsForHash().get("redisHash","age"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751627840"></a>8.1.2.14.4. delete</h5></div></div></div><p>删除指定的哈希 hashKeys</p><pre class="programlisting">
				
	System.out.println(redisTemplate.opsForHash().delete("redisHash","name"));
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751626800"></a>8.1.2.14.5. 确定哈希hashKey是否存在</h5></div></div></div><p>确定哈希hashKey是否存在</p><pre class="programlisting">
				
System.out.println(redisTemplate.opsForHash().hasKey("redisHash","age"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751625744"></a>8.1.2.14.6. 从哈希中获取指定的多个 hashKey 的值</h5></div></div></div><pre class="programlisting">
				
	List&lt;Object&gt; keys = new ArrayList&lt;Object&gt;();
    keys.add("name");
    keys.add("age");
    System.out.println(redisTemplate.opsForHash().multiGet("redisHash",keys))				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751624848"></a>8.1.2.14.7. 只有hashKey不存在时才能添加值</h5></div></div></div><pre class="programlisting">
				
	System.out.println(redisTemplate.opsForHash().putIfAbsent("redisHash","age",30));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751624048"></a>8.1.2.14.8. 获取整个Hash</h5></div></div></div><pre class="programlisting">
				
System.out.println(redisTemplate.opsForHash().entries("redisHash"));					
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252751623280"></a>8.1.2.14.9. 获取所有key</h5></div></div></div><pre class="programlisting">
				

System.out.println(redisTemplate.opsForHash().keys("redisHash1"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252752940240"></a>8.1.2.14.10. 通过 hashKey 获取所有值</h5></div></div></div><pre class="programlisting">
				
System.out.println(redisTemplate.opsForHash().values("redisHash"));				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252752939456"></a>8.1.2.14.11. 值加法操作</h5></div></div></div><pre class="programlisting">
				
System.out.println(redisTemplate.opsForHash().increment("redisHash","age",1)				
				
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252752938688"></a>8.1.2.14.12. 遍历 Hash 表</h5></div></div></div><pre class="programlisting">
				
	Cursor&lt;Map.Entry&lt;Object, Object&gt;&gt; curosr = redisTemplate.opsForHash().scan("redisHash", ScanOptions.ScanOptions.NONE);
	while(curosr.hasNext()){
	    Map.Entry&lt;Object, Object&gt; entry = curosr.next();
	    System.out.println(entry.getKey()+":"+entry.getValue());
	}				
				
				</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="redisTemplate.expire"></a>8.1.2.15. 过期时间未执行</h4></div></div></div><p>Spring Redis 中设置过期时间方法如下</p><pre class="programlisting">
		
设置 key
redisTemplate.opsForValue().setIfAbsent("key", "value");
设置过期时间
redisTemplate.expire("key", 30000, TimeUnit.MILLISECONDS);
释放 key
redisTemplate.delete("key");		
		
			</pre><p>这样存在一个问题，当程序运行一半被强行终止，可能导致setIfAbsent运行完成，但是expire未被执行，这样 key 便永远不会释放。解决方案如下，使用RedisCallback执行原生 Redis 命令。</p><pre class="programlisting">
		
String result = redisTemplate.execute(new RedisCallback&lt;String&gt;() {
	@Override
	public String doInRedis(RedisConnection connection) throws DataAccessException {
		JedisCommands commands = (JedisCommands) connection.getNativeConnection();
		return commands.set(key, value, "NX", "PX", expire);
	}
});		
		
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252752935200"></a>8.1.2.16. setBit / getBit 二进制位操作</h4></div></div></div><pre class="screen">
			
setBit Boolean setBit(K key, long offset, boolean value);

offset 二进制位置(从左向右数)
value 位 ture 表示 0，false 表示 1			
			
			</pre><pre class="programlisting">
			
    // 'a' 的ASCII码是 97 转换为二进制是：01100001
    // 'b' 的ASCII码是 98 转换为二进制是：01100010
    // 'c' 的ASCII码是 99 转换为二进制是：01100011
    			
	redisTemplate.opsForValue().set("bitTest","a");    
    
    redisTemplate.opsForValue().setBit("bitTest",7, false); 	// 01100011
    redisTemplate.opsForValue().setBit("bitTest",8, true);	// 01100010
    System.out.println(redisTemplate.opsForValue().get("bitTest"));
    redisTemplate.opsForValue().setBit("bitTest",8, false);	// 01100011
    System.out.println(redisTemplate.opsForValue().get("bitTest"));			
			
			</pre><p>getBit Boolean getBit(K key, long offset); 获取键对应值的ascii码的在offset处位值</p><pre class="programlisting">
			
System.out.println(redisTemplate.opsForValue().getBit("bitTest",7));			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="JsonRedisTemplate"></a>8.1.2.17. 存储 Json 对象</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252752932080"></a>8.1.2.17.1. 集成 RedisTemplate 定义新类 JsonRedisTemplate</h5></div></div></div><pre class="programlisting">
			
package cn.netkiller.wallet.redis;

import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;
import org.springframework.data.redis.serializer.RedisSerializer;
import org.springframework.data.redis.serializer.StringRedisSerializer;

import com.fasterxml.jackson.databind.ObjectMapper;

public class JsonRedisTemplate extends RedisTemplate&lt;String, Object&gt; {

	public JsonRedisTemplate(RedisConnectionFactory connectionFactory, ObjectMapper objectMapper, Class&lt;?&gt; valueType) {
		RedisSerializer&lt;String&gt; stringSerializer = new StringRedisSerializer();
		super.setKeySerializer(stringSerializer);
		super.setHashKeySerializer(stringSerializer);
		super.setHashValueSerializer(stringSerializer);
		Jackson2JsonRedisSerializer&lt;?&gt; jsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(valueType);
		jsonRedisSerializer.setObjectMapper(objectMapper);
		super.setValueSerializer(jsonRedisSerializer);
		super.setConnectionFactory(connectionFactory);
		super.afterPropertiesSet();
	}
}
			
			
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252752931296"></a>8.1.2.17.2. 配置 Redis</h5></div></div></div><pre class="programlisting">
			
package cn.netkiller.wallet.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.listener.ChannelTopic;
import org.springframework.data.redis.listener.RedisMessageListenerContainer;
import org.springframework.data.redis.listener.adapter.MessageListenerAdapter;

import com.fasterxml.jackson.databind.ObjectMapper;

import cn.netkiller.wallet.redis.JsonRedisTemplate;
import cn.netkiller.wallet.redis.RedisMessageSubscriber;

@Configuration
public class RedisConfig {

	public RedisConfig() {
	}

	@Bean
	public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory connectionFactory) {
		StringRedisTemplate redisTemplate = new StringRedisTemplate();
		redisTemplate.setConnectionFactory(connectionFactory);
		return redisTemplate;
	}

	@Bean
	public MessageListenerAdapter messageListener() {
		return new MessageListenerAdapter(new RedisMessageSubscriber());
	}

	@Bean
	public ChannelTopic topic() {
		return new ChannelTopic("demo");
	}

	@Bean
	public RedisMessageListenerContainer redisContainer(RedisConnectionFactory connectionFactory, MessageListenerAdapter messageListener) {
		RedisMessageListenerContainer container = new RedisMessageListenerContainer();

		container.setConnectionFactory(connectionFactory);
		container.addMessageListener(messageListener(), topic());
		container.addMessageListener(messageListener(), new ChannelTopic("test"));
		return container;
	}

	@Bean
	public ObjectMapper objectMapper() {
		return new ObjectMapper();
	}

	@Bean
	public JsonRedisTemplate jsonRedisTemplate(RedisConnectionFactory connectionFactory, ObjectMapper objectMapper) {
		return new JsonRedisTemplate(connectionFactory, objectMapper, Object.class);
	}

}
			
			
				</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idm252752930656"></a>8.1.2.17.3. 测试</h5></div></div></div><pre class="programlisting">
			
package cn.netkiller.wallet.restful;

import java.io.IOException;
import java.util.UUID;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.listener.ChannelTopic;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import cn.netkiller.wallet.pojo.RestfulResponse;
import cn.netkiller.wallet.redis.JsonRedisTemplate;
import cn.netkiller.wallet.redis.RedisMessagePublisher;

@RestController
public class TestRestController {
	private static final Logger logger = LoggerFactory.getLogger(TestRestController.class);

	@Autowired
	private StringRedisTemplate stringRedisTemplate;

	@Autowired
	private JsonRedisTemplate jsonRedisTemplate;

	public TestRestController() {

	}

	@GetMapping("/version")
	public String version() throws IOException {
		Web3ClientVersion web3ClientVersion = web3j.web3ClientVersion().send();
		String clientVersion = web3ClientVersion.getWeb3ClientVersion();
		logger.info(clientVersion);
		return clientVersion;
	}

	@GetMapping("/pub/demo")
	public String pub() {

		RedisMessagePublisher publisher = new RedisMessagePublisher(stringRedisTemplate, new ChannelTopic("demo"));
		String message = "Message " + UUID.randomUUID();
		publisher.publish(message);
		return message;
	}

	@GetMapping("/pub/test")
	public String pub(@RequestParam String message) {

		RedisMessagePublisher publisher = new RedisMessagePublisher(stringRedisTemplate, new ChannelTopic("test"));
		publisher.publish(message);
		return message;
	}

	@GetMapping("/pub/json")
	public RestfulResponse pubJson() {
		RestfulResponse restfulResponse = new RestfulResponse(true, 0, null, null);
		jsonRedisTemplate.opsForValue().set("test", restfulResponse);
		jsonRedisTemplate.convertAndSend("test", restfulResponse);
		return restfulResponse;
	}
}
			
				</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="RedisRepository"></a>8.1.3. Spring Data Redis - Repository Examples</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252752929408"></a>8.1.3.1. @EnableRedisRepositories 启动 Redis 仓库</h4></div></div></div><pre class="programlisting">
			
package api.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.repository.configuration.EnableRedisRepositories;

@Configuration
@EnableRedisRepositories
public class CachingConfigurer {

}			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252752928368"></a>8.1.3.2. 定义 Domain 类</h4></div></div></div><pre class="programlisting">
			
package api.domain;

import java.util.List;

import org.springframework.data.annotation.Id;
import org.springframework.data.annotation.Reference;
import org.springframework.data.redis.core.RedisHash;
import org.springframework.data.redis.core.index.Indexed;

@RedisHash("persons")
public class Person {

	public enum Gender {
		FEMALE, MALE
	}

	@Id
	private String id;

	@Indexed
	private String firstname;
	@Indexed
	private String lastname;

	private Gender gender;
	private Address address;

	@Reference
	private List&lt;Person&gt; children;

	public Person() {
		// TODO Auto-generated constructor stub
	}

	public String getId() {
		return id;
	}

	public void setId(String id) {
		this.id = id;
	}

	public String getFirstname() {
		return firstname;
	}

	public void setFirstname(String firstname) {
		this.firstname = firstname;
	}

	public String getLastname() {
		return lastname;
	}

	public void setLastname(String lastname) {
		this.lastname = lastname;
	}

	public Gender getGender() {
		return gender;
	}

	public void setGender(Gender gender) {
		this.gender = gender;
	}

	public Address getAddress() {
		return address;
	}

	public void setAddress(Address address) {
		this.address = address;
	}

	public List&lt;Person&gt; getChildren() {
		return children;
	}

	public void setChildren(List&lt;Person&gt; children) {
		this.children = children;
	}

	@Override
	public String toString() {
		return "Person [id=" + id + ", firstname=" + firstname + ", lastname=" + lastname + ", gender=" + gender + ", address=" + address + ", children=" + children + "]";
	}

}
			
			
			</pre><p></p><pre class="programlisting">
			
package api.domain;

import org.springframework.data.geo.Point;
import org.springframework.data.redis.core.index.GeoIndexed;
import org.springframework.data.redis.core.index.Indexed;

public class Address {

	private @Indexed String city;
	private String country;
	private @GeoIndexed Point location;

	public Address(String city, String country, Point location) {
		this.city = city;
		this.country = country;
		this.location = location;
	}

	public String getCity() {
		return city;
	}

	public void setCity(String city) {
		this.city = city;
	}

	public String getCountry() {
		return country;
	}

	public void setCountry(String country) {
		this.country = country;
	}

	public Point getLocation() {
		return location;
	}

	public void setLocation(Point location) {
		this.location = location;
	}

}			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252752926480"></a>8.1.3.3. Repository 接口</h4></div></div></div><pre class="programlisting">
			
package api.repository;

import java.util.List;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.geo.Circle;
import org.springframework.data.repository.CrudRepository;

import api.domain.Person;

public interface PersonRepository extends CrudRepository&lt;Person, String&gt; {
	List&lt;Person&gt; findByLastname(String lastname);

	Page&lt;Person&gt; findPersonByLastname(String lastname, Pageable page);

	List&lt;Person&gt; findByFirstnameAndLastname(String firstname, String lastname);

	List&lt;Person&gt; findByFirstnameOrLastname(String firstname, String lastname);

	List&lt;Person&gt; findByAddress_City(String city);

	List&lt;Person&gt; findByAddress_LocationWithin(Circle circle);
}
			
			
			</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm252752925056"></a>8.1.3.4. 测试代码</h4></div></div></div><pre class="programlisting">
			
package api.restful;

import java.util.Arrays;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.geo.Point;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import api.domain.Person;
import api.domain.Address;

import api.repository.PersonRepository;

@RestController
@RequestMapping("/test")
public class TestRestController {
	private static final Logger logger = LoggerFactory.getLogger(TestRestController.class);

	@Autowired
	private PersonRepository personRepository;

	public TestRestController() {

	}

	@GetMapping("/redis")
	public Person redis() {

		Person children = new Person();
		children.setFirstname("Lisa");
		children.setLastname("Chen");
		children.setGender(Person.Gender.FEMALE);

		Person person = new Person();
		person.setFirstname("Neo");
		person.setLastname("Chen");
		person.setGender(Person.Gender.MALE);

		// List&lt;Person&gt; childrens = new ArrayList&lt;Person&gt;();

		person.setChildren(Arrays.asList(children));

		Point point = new Point(Double.valueOf("28.352734"), Double.valueOf("32.807382"));
		Address address = new Address("Shenzhen", "China", point);
		person.setAddress(address);
		personRepository.save(person);
		return person;
	}

}
			
			</pre></div></div></div></div><div xmlns="" id="SOHUCS"></div><script xmlns="" charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/changyan.js"></script><script xmlns="" type="text/javascript">
window.changyan.api.config({
appid: 'cyvwjQUG3',
conf: 'prod_ef966242df3d8b5acb1e0ee9fc01cafe'
});
</script><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../WebFlux/webflux.router.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="../index.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="spring-data-mongodb.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">7.2. WebFlux Router </td><td width="20%" align="center"><a accesskey="h" href="../../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 8.2. Spring Data with MongoDB</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script></body></html>