<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>1.23. 环境差异带来的困扰</title><link rel="stylesheet" type="text/css" href="docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="home" href="index.html" title="Netkiller Architect 手札" /><link rel="up" href="多维度架构设计.html" title="第 1 章 多维度架构设计" /><link rel="prev" href="多维度架构设计之线程池.html" title="1.22. 多维度架构设计之线程池" /><link rel="next" href="microphone.html" title="1.24. 人工智能语音交互开发·麦克风" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> | <a xmlns="" href="//netkiller.github.io/">简体中文</a> | <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> | <a xmlns="" href="/journal/index.html">杂文</a>
		| <a xmlns="" href="https://github.com/netkiller">Github</a> | <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> | <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> | <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> | <a xmlns="" href="https://www.youtube.com/user/bg7nyt/videos">Youtube</a> | <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> | <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.23. 环境差异带来的困扰</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="多维度架构设计之线程池.html">上一页</a> </td><th width="60%" align="center">第 1 章 多维度架构设计</th><td width="20%" align="right"> <a accesskey="n" href="microphone.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a></td><td></td><td></td><td></td><td></td></tr></table><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="环境差异带来的困扰"></a>1.23. 环境差异带来的困扰</h2></div></div></div>
	
	<p>工作中你是否因环境的差异带来困扰，下面我总结了一些因为环境差异给开发者造成的困扰。</p>
	<div class="orderedlist"><p class="title"><strong>环境差异带来的困扰：</strong></p><ol class="orderedlist" type="1"><li class="listitem">在网上找到的例子，在自己的电脑上始终运行不起来</li><li class="listitem">本地电脑运行一切正常，发不到测试环境就出问题</li><li class="listitem">测试环境通过，发布到生产环境就出问题</li></ol></div>
	<div class="orderedlist"><p class="title"><strong>问题根源出在哪里？</strong></p><ol class="orderedlist" type="1"><li class="listitem">版本不一致</li><li class="listitem">环境差异造成的</li><li class="listitem">性能问题造成的</li><li class="listitem">架构问题造成的</li></ol></div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="版本的差异"></a>1.23.1. 版本的差异</h3></div></div></div>
		
		<p>搜索引擎、Ctrl+C、Ctrl+V 是程序员三件法宝，几乎占用了程序员的80%的工作。</p>
		<p>但是我们常常会遇到一个问题，就是在网上找到的例子，复制到自己的开发环境，无法运行，通常有一下几个因素。</p>
		<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">编译器的版本不匹配</li><li class="listitem">依赖库不匹配</li><li class="listitem">配置文件不匹配</li></ol></div>
		<p>工作中我就遇到过这样的问题，我接手了一个项目，生产环境每日救火，性能十分差，经过分析是配置没有生效。开发同事到网上找到一篇配置文章，直接照搬网上配置，也没有去做验证，那个配置是 springboot 1.x, 在 2.x 已经废弃，所以配置是不生效的。 </p>
		<p>上面的案例在很多团队中都会发生。</p>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="环境的差异"></a>1.23.2. 环境的差异</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1052"></a>1.23.2.1. 办公电脑</h4></div></div></div>
			
			<p>办公电脑跟服务器的差异是什么？</p>
			<p>所谓服务器，并不是服务器性能比台式机高，很多服务器配置非常低，例如物联网用的。服务器更多是指她能7*24小时稳定运行，出现死机频率比较台式电脑低，为了能让服务器7*24小时工作，在硬件设计方面更考究，使用材料，设计方案，都是为了满足长时间可靠运行，所以服务器的成本会增加。</p>
			<p>而台式机（办公电脑）通常每天工作时常不会超过16小时，也就是会关机一次，第二天在开机，任何问题重启都能解决（万能重启），重启可以掩盖很多问题。</p>
			<p>我们现在使用的办公电脑配置都很高，轮核心数量，内存容量，并不比服务器差，性能更是秒杀云主机。台式机还有一个优势，基本都会配置显卡。</p>
			<p>为什么在本地电脑开发完成的功能，上到测试环境就运行不了？</p>
			<div class="orderedlist"><p class="title"><strong>本地电脑 VS 测试环境</strong></p><ol class="orderedlist" type="1"><li class="listitem">很多时候测试环境需要模拟生产环境，需要很多节点，服务器资源有限，只能压缩测试节点数量，对测试节点的硬件资源限额，也就是说测试环境的节点配置，没有你本地电脑配置高。</li><li class="listitem">自在独享本地资源做开发，不会有其他服务跟你争夺硬件资源。而测试环境是共享的，上面部署不止一套系统，它们之间相互争夺硬件资源。</li><li class="listitem"></li></ol></div>
			<p>假如开发了一个下载 excle 数据的功能，在本地电脑上测试，从查询数据库，数据组装，生成xls文件，然后下载，几乎是鼠标一点就完成。此时发布到测试环境，你发现这个功能根本不能用，需要优化。 </p>
			<p>因为你一个人在用一台 8核心 16G 256SSD硬盘的电脑，并且只启动了一个服务；而测试环境上运行几十个服务，同时做了资源配额，分配的资源仅有4核心，4G，硬盘还是机械的。</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1053"></a>1.23.2.2. 物理机与虚拟机</h4></div></div></div>
			
			<p>服务器资源有限，为了更合理利用服务器，通常我们会使用虚拟化技术。</p>
			<p></p>
			<p></p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1054"></a>1.23.2.3. 云主机与容器</h4></div></div></div>
			
			<p>因为你本地开发/测试环境使用了容器技术，所以你也想在云主机上使用容器技术。</p>
			<p>云主机</p>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id1065"></a>1.23.3. 常见问题</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1055"></a>1.23.3.1. 超时时间</h4></div></div></div>
			
			<p>本地开发环境只需在应用上配置超时时间即可，我们是直接访问应用的。</p>
			<p>测试环境就可能涉及的网关，负载均衡等等多处设置。那么在集群环境中都会涉及那些超时时间的配置呢？</p>
			<div class="itemizedlist"><p class="title"><strong>经常涉及的超时配置：</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">负载均衡</li><li class="listitem">Web 服务器/反向代理</li><li class="listitem">微服务网关</li><li class="listitem">微服务应用连接超时阀值，包括（tomcat、openfeign、ribbon、RestTemplate、hikari、redis、rocketmq、httpclient/okhttp 等等）</li><li class="listitem">Redis 超时时间</li><li class="listitem">MySQL 连接超时时间，执行超时时间</li></ul></div>
			<p>生产环境只会更复杂。</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1056"></a>1.23.3.2. 连接数</h4></div></div></div>
			
			<p>你从公司行政领了一台电脑，搬到工位上装好开机，然后一顿操作猛如虎就把开发环境搭建起来。</p>
			<p>然后就开始写代码了，开发、联调、测试一切顺利，冒烟通过之后，准备发到测试环境做集成测试/压力测试/性能测试……</p>
			<p></p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1057"></a>1.23.3.3. 上传限制</h4></div></div></div>
			
			<p></p>
			<p></p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1058"></a>1.23.3.4. 下载带宽</h4></div></div></div>
			
			<p>办公室网络通常是使用的是 1G 局域网，我们在局域网之内的各种请求几乎是瞬间响应</p>
			<p></p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1059"></a>1.23.3.5. CPU 资源限制</h4></div></div></div>
			
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1060"></a>1.23.3.6. 内存资源限制</h4></div></div></div>
			
			<p>容器 PodOOMKilling</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1061"></a>1.23.3.7. 雪花算法出现重复</h4></div></div></div>
			
			<p>在容器加微服务的解决方案中使用雪花算法，很容易出现数据重复。</p>
			
			<p></p>
			<p></p>
			<p></p>
			<p></p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1062"></a>1.23.3.8. 注册中心</h4></div></div></div>
			
			<p>注册中心都有那些问题困扰我们？</p>
			<div class="itemizedlist"><p class="title"><strong>开发中遇到的问题：</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">本地电脑注册到测试环境，我们常常不小心，把开发自己的的开发环境注册到注册中心，导致其他微服务连接到我们的开发环境上。</li><li class="listitem">还有时我们注册导了测试环境，把测试环境的消息队列中的内容给消费了.</li><li class="listitem">与容器联调，容器pod无法跟本地电脑打通。解决方法添加路由，对于开发人员操作是分复杂。</li></ul></div>
			<div class="itemizedlist"><p class="title"><strong>生产中遇到的问题：</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"></li><li class="listitem"></li></ul></div>
			<p>当微服务节点注册导注册中心后，通过心跳来维持节点的存活。</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1063"></a>1.23.3.9. 负载均衡</h4></div></div></div>
			
			<p>负载均衡节点分配有多种算法，例如轮询、随机、源IP地址、HASH、Cookie、加权等等……</p>
			<p>其中又些算法，例如轮询、随机，它是不保持与请求客户端之间的关系，当你下一次请求，节点就会发生变化。这样就你不知道那个节点执行了你的请求。</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id1064"></a>1.23.3.10. 健康检查</h4></div></div></div>
			
			<p>健康检查误判的问题</p>
			<p></p>
		</div>
	</div>
</div><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="多维度架构设计之线程池.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="多维度架构设计.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="microphone.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">1.22. 多维度架构设计之线程池 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 1.24. 人工智能语音交互开发·麦克风</td></tr></table></div><script xmlns="">
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-11694057-1', 'auto');
			ga('send', 'pageview');

		</script><script xmlns="" async="async">
			var _hmt = _hmt || [];
			(function() {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
			})();
</script><script xmlns="" async="async">
			(function(){
			var bp = document.createElement('script');
			var curProtocol = window.location.protocol.split(':')[0];
			if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
			}
			else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
			}
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(bp, s);
			})();
</script></body></html>